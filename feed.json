{
    "version": "https://jsonfeed.org/version/1",
    "title": "æœ¨å­äº­",
    "subtitle": "é‚£å¹´æ»¡èº«ç°ç™½ï¼Œå”¯æ­¤äº­æº¢å½©ï¼Œä»Šæ—¥ä¸æŸ“å°˜åŸƒï¼Œé™åæ­¤äº­ç›¸ä¼´",
    "icon": "https://zimu-66ccff.github.io/images/favicon.ico",
    "description": "å¹²å‡€æ¾„æ¾ˆï¼ŒçœŸè¯šè‡ªç„¶",
    "home_page_url": "https://zimu-66ccff.github.io",
    "items": [
        {
            "id": "https://zimu-66ccff.github.io/reactivity-effect/",
            "url": "https://zimu-66ccff.github.io/reactivity-effect/",
            "title": "Vueå“åº”å¼æ¨¡å—-reactivity-effect",
            "date_published": "2023-02-14T05:57:48.000Z",
            "content_html": "<h1 id=\"effect-æ–¹æ³•å‰–æä¸å®ç°\"><a class=\"anchor\" href=\"#effect-æ–¹æ³•å‰–æä¸å®ç°\">#</a> effect æ–¹æ³•å‰–æä¸å®ç°</h1>\n<h2 id=\"å®Œæ•´ä»£ç \"><a class=\"anchor\" href=\"#å®Œæ•´ä»£ç \">#</a> å®Œæ•´ä»£ç </h2>\n<figure class=\"highlight typescript\"><figcaption data-lang=\"typescript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> <span class=\"token class-name\">EffectFn</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  deps<span class=\"token operator\">:</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span>Set<span class=\"token operator\">&lt;</span>EffectFn<span class=\"token operator\">>></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  options<span class=\"token operator\">?</span><span class=\"token operator\">:</span> Options<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Options</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  scheduler<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>fn<span class=\"token operator\">:</span> EffectFn<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  lazy<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">let</span> activeEffect<span class=\"token operator\">:</span> EffectFn<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">const</span> effectStarck<span class=\"token operator\">:</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span>EffectFn<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">const</span> targetMap<span class=\"token operator\">:</span> WeakMap<span class=\"token operator\">&lt;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  object<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  Map<span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> Set<span class=\"token operator\">&lt;</span>EffectFn<span class=\"token operator\">></span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token operator\">></span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WeakMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">effect</span><span class=\"token punctuation\">(</span><span class=\"token function-variable function\">fn</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> options<span class=\"token operator\">?</span><span class=\"token operator\">:</span> Options<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token keyword\">const</span> effectFn<span class=\"token operator\">:</span> <span class=\"token function-variable function\">EffectFn</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token function\">clearUp</span><span class=\"token punctuation\">(</span>effectFn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    activeEffect <span class=\"token operator\">=</span> effectFn<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    effectStarck<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>effectFn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    effectStarck<span class=\"token punctuation\">.</span><span class=\"token function\">pop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    activeEffect <span class=\"token operator\">=</span> effectStarck<span class=\"token punctuation\">[</span>effectStarck<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  effectFn<span class=\"token punctuation\">.</span>deps <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span>Set<span class=\"token operator\">&lt;</span>EffectFn<span class=\"token operator\">>></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  effectFn<span class=\"token punctuation\">.</span>options <span class=\"token operator\">=</span> options<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>effectFn<span class=\"token punctuation\">.</span>options<span class=\"token operator\">?.</span>lazy<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">return</span> effectFn<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token function\">effectFn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">clearUp</span><span class=\"token punctuation\">(</span>fn<span class=\"token operator\">:</span> EffectFn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  fn<span class=\"token punctuation\">.</span>deps<span class=\"token operator\">?.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>deps<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    deps<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>fn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"effect-æ¦‚è¿°\"><a class=\"anchor\" href=\"#effect-æ¦‚è¿°\">#</a> effect æ¦‚è¿°</h2>\n<p><code>effect</code>  æ˜¯ä¸€ä¸ªç”¨æ¥æ³¨å†Œå‰¯ä½œç”¨çš„å‡½æ•°ï¼Œå®ƒé»˜è®¤ä¼šå°†æ³¨å†Œçš„å‰¯ä½œç”¨ç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶æ”¯æŒä¼ é€’ä¸€ä¸ªé€‰é¡¹å‚æ•° <code>options</code> ï¼Œå¯ä»¥é…ç½®æ˜¯å¦ç«‹å³æ‰§è¡Œï¼Œå°†å‰¯ä½œç”¨å‡½æ•°è¿”å›ä»¥ä¾¿äºæ‰‹åŠ¨æ‰§è¡Œ and é…ç½®è°ƒåº¦å™¨ <code>scheduler</code></p>\n<h2 id=\"éƒ¨åˆ†å˜é‡å±æ€§æ–¹æ³•ä»‹ç»\"><a class=\"anchor\" href=\"#éƒ¨åˆ†å˜é‡å±æ€§æ–¹æ³•ä»‹ç»\">#</a> éƒ¨åˆ†å˜é‡ï¼Œå±æ€§ï¼Œæ–¹æ³•ä»‹ç»</h2>\n<ul>\n<li><strong> <code>activeEffect</code> </strong> : ç”¨æ¥å­˜å‚¨å½“å‰çš„å‰¯ä½œç”¨å‡½æ•°</li>\n<li><strong> <code>effectStrack</code> </strong> : å› ä¸º <code>effect</code>  å¯èƒ½ä¼šåµŒå¥—  <code>effect</code>  ï¼Œæ‰€ä»¥éœ€è¦ç”¨ <code>effectStrack</code>  æ¥å­˜å‚¨è¿™äº›åµŒå¥—çš„<strong>å‰¯ä½œç”¨å‡½æ•°</strong>ï¼Œå½“å†…å±‚çš„ <code>effect</code>  æ‰§è¡Œå®Œæ¯•åï¼Œå°†<strong>å†…å±‚çš„å‰¯ä½œç”¨å‡½æ•°</strong>å¼¹å‡ºï¼Œå°†<strong>å¤–å±‚çš„å‰¯ä½œç”¨å‡½æ•°</strong>èµ‹å€¼ç»™ç”¨æ¥å­˜å‚¨<strong>å½“å‰çš„å‰¯ä½œç”¨å‡½æ•°</strong>çš„ <code>activeEffect</code> ã€‚</li>\n<li><strong> <code>targetMap</code> </strong>: ä¸€ç§ <code>WeakMap</code>  ç»“æ„ï¼Œç”¨æ¥å­˜å‚¨ <code>target</code> ,  <code>key</code> , <strong>å‰¯ä½œç”¨</strong>ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚<br />\n<img data-src=\"https://i.328888.xyz/2023/02/14/mVXrd.png\" alt=\"å…³ç³»å›¾\" /></li>\n<li><strong> <code>effectFn.deps</code> </strong>: ç±»å‹ä¸º <code>Array&lt;Set&gt;</code> ï¼Œç”¨æ¥å­˜å‚¨ä¿å­˜çš„æœ‰è¯¥å‰¯ä½œç”¨çš„ <code>target</code>  å¯¹åº”çš„ <code>key</code>  å¯¹åº”çš„ <code>Set</code> , ä»¥ä¾¿äºåœ¨å‰¯ä½œç”¨å‡½æ•°<strong>å†æ¬¡æ‰§è¡Œ</strong>çš„æ—¶å€™è°ƒç”¨çš„ <code>clearUp</code>  æ–¹æ³•æ¥å°† <code>effectFn</code>  ä»è¿™äº› <code>Set</code>  ä¸­ç§»é™¤ã€‚</li>\n<li><strong> <code>clearUp</code> </strong> : åˆ©ç”¨ <code>effectFn.deps</code>  å°† <code>effectFn</code>  ä»å…¶æ‰€åœ¨çš„ <code>Set</code>  ä¸­ç§»é™¤ã€‚</li>\n</ul>\n<h2 id=\"è¯¦ç»†æ­¥éª¤\"><a class=\"anchor\" href=\"#è¯¦ç»†æ­¥éª¤\">#</a> è¯¦ç»†æ­¥éª¤</h2>\n<ul>\n<li>å®šä¹‰ <code>effectFn</code>  å¢å¼ºç‰ˆå‰¯ä½œç”¨å‡½æ•°ï¼Œä»¥ä¾¿äºå¢å¼ºå®ƒï¼Œå¹¶åšè¿›ä¸€æ­¥å¤„ç†\n<ul>\n<li><code>effectFn</code>  å‡½æ•°å°†åšçš„äº‹æƒ…\n<ol>\n<li>è°ƒç”¨ <code>clearUp</code>  æ¥å°† <code>effectFn</code>  ä»å…¶æ‰€åœ¨çš„ <code>Set</code>  ä¸­ç§»é™¤ï¼Œä»è€Œé¿å… <code>trigger</code>  è§¦å‘æ²¡å¿…è¦çš„å‰¯ä½œç”¨å‡½æ•°ã€‚</li>\n<li>å°† <code>effectFn</code>  èµ‹å€¼ç»™ <code>activeEffect</code> , å¹¶å°† <code>effectFn</code>  æ”¾è¿› <code>effectStack</code> ã€‚</li>\n<li>è°ƒç”¨ <code>fn</code>  å‰¯ä½œç”¨å‡½æ•°ï¼Œå°†è¿”å›å€¼ä¿å­˜è¿› <code>res</code> ã€‚</li>\n<li>å°† <code>effectFn</code>  ä» <code>activeEffect</code>  ä¸­å¼¹å‡ºï¼Œå¹¶å°† <code>activeEffect</code>  çš„æœ€åä¸€ä¸ªå…ƒç´ èµ‹å€¼ç»™ <code>activeEffect</code> ï¼ˆè®© <code>activeEffect</code>  æŒ‡å‘å¤–å±‚çš„å‰¯ä½œç”¨å‡½æ•°ï¼‰</li>\n<li>è¿”å› <code>res</code></li>\n</ol>\n</li>\n</ul>\n</li>\n<li>åœ¨ <code>effectFn</code>  å‡½æ•°ä¸Šæ·»åŠ å±æ€§ï¼Œå¢å¼ºå®ƒ\n<ul>\n<li>åœ¨ <code>effectFn</code>  ä¸Šæ·»åŠ  <code>deps</code>  å±æ€§ï¼Œç”¨æ¥å­˜å‚¨ä¿å­˜æœ‰è¯¥å‰¯ä½œç”¨å‡½æ•°çš„ <code>target</code>  å¯¹åº”çš„ <code>key</code>  çš„å¯¹åº”çš„ <code>Set</code> , ä»¥æä¾›ç»™ <code>clearUp</code>  å‡½æ•°ä½¿ç”¨ã€‚</li>\n<li>åœ¨ <code>effectFn</code>  å‡½æ•°ä¸Šæ·»åŠ  <code>options</code>  å±æ€§ï¼Œä¿å­˜å‰¯ä½œç”¨å‡½æ•°çš„é…ç½®é€‰é¡¹ã€‚</li>\n</ul>\n</li>\n<li>æ ¹æ® <code>effectFn</code>  å‡½æ•°çš„é…ç½®é€‰é¡¹ <code>options</code>  å±æ€§ï¼Œæ¥è¿›è¡Œä¸‹ä¸€æ­¥çš„æ“ä½œ\n<ul>\n<li>å¦‚æœ <code>effectFn.options.lazy</code>  ä¸º <code>true</code> ï¼Œåˆ™ä¸ç«‹å³æ‰§è¡Œ <code>effectFn</code> , è€Œæ˜¯å°† <code>effectFn</code>  è¿”å›ï¼Œæ‰‹åŠ¨è°ƒç”¨ã€‚</li>\n<li>å¦‚æœä¸º <code>false</code> ï¼Œ åˆ™ç«‹å³æ‰§è¡Œã€‚</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"track-æ–¹æ³•å‰–æä¸å®ç°\"><a class=\"anchor\" href=\"#track-æ–¹æ³•å‰–æä¸å®ç°\">#</a> track æ–¹æ³•å‰–æä¸å®ç°</h1>\n<h2 id=\"å®Œæ•´ä»£ç -2\"><a class=\"anchor\" href=\"#å®Œæ•´ä»£ç -2\">#</a> å®Œæ•´ä»£ç </h2>\n<figure class=\"highlight typescript\"><figcaption data-lang=\"typescript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">track</span><span class=\"token punctuation\">(</span>target<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> key<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>activeEffect<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token keyword\">let</span> depsMap <span class=\"token operator\">=</span> targetMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>depsMap<span class=\"token punctuation\">)</span> targetMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>depsMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">let</span> deps <span class=\"token operator\">=</span> depsMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>deps<span class=\"token punctuation\">)</span> depsMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>deps <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  deps<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>activeEffect<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  activeEffect<span class=\"token punctuation\">.</span>deps<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>deps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"track-æ¦‚è¿°\"><a class=\"anchor\" href=\"#track-æ¦‚è¿°\">#</a> track æ¦‚è¿°</h2>\n<p>ç”¨æ¥æ”¶é›†å‰¯ä½œç”¨ï¼Œå°†å‰¯ä½œç”¨å­˜å‚¨è¿›å¯¹åº”çš„ <code>target</code>  å¯¹åº”çš„ <code>key</code>  å¯¹åº”çš„ <code>Set</code> ã€‚</p>\n<h2 id=\"è¯¦ç»†æ­¥éª¤-2\"><a class=\"anchor\" href=\"#è¯¦ç»†æ­¥éª¤-2\">#</a> è¯¦ç»†æ­¥éª¤</h2>\n<ul>\n<li>è¾¹ç•Œå¤„ç†\n<ul>\n<li>å¦‚æœ <code>activeEffect == undefined</code> ï¼Œåˆ™ç›´æ¥è¿”å›</li>\n</ul>\n</li>\n<li>å°†å‰¯ä½œç”¨å‡½æ•°å­˜å‚¨è¿›å¯¹åº”çš„ <code>Set</code>\n<ol>\n<li>è°ƒç”¨ <code>targetMap.get(target)</code>  å–å‡º <code>target</code>  å¯¹åº”çš„ <code>Map</code> ï¼ˆé‡Œé¢å­˜å‚¨çš„æ˜¯ <code>key</code>  å’Œå¯¹åº”çš„ <code>Set</code> ï¼‰å¹¶èµ‹å€¼ç»™ <code>depsMap</code> ã€‚å¦‚æœ <code>depsMao</code>  ä¸ºç©ºï¼Œåˆ™è°ƒç”¨ <code>targetMap.set(target, (depsMap = new Map))</code>  æ–°å»ºä¸€ä¸ª <code>Map</code>  å­˜è¿› <code>targetMap</code> ã€‚</li>\n<li>è°ƒç”¨ <code>depsMap.get(key)</code>  å–å‡º <code>key</code>  å¯¹åº”çš„ <code>Set</code>  (é‡Œé¢å­˜å‚¨çš„æ˜¯ <code>key</code>  å¯¹åº”çš„å‰¯ä½œç”¨å‡½æ•°) å¹¶èµ‹å€¼ç»™ <code>deps</code> ã€‚å¦‚æœ <code>deps</code>  ä¸å­˜åœ¨ï¼Œåˆ™è°ƒç”¨ <code>depsMap.set(key, (deps = new Set()))</code>  æ–°å»ºä¸€ä¸ª <code>Set</code>  å­˜è¿› <code>depsMap</code> ã€‚</li>\n<li>è°ƒç”¨ <code>deps.add(activeEffect)</code>  å°†å‰¯ä½œç”¨å‡½æ•°å­˜å‚¨è¿› <code>Set</code> .</li>\n</ol>\n</li>\n<li>å°†å­˜æœ‰è¯¥å‰¯ä½œç”¨å‡½æ•°çš„ <code>Set</code>  å­˜å‚¨è¿› <code>activeEffect.deps</code></li>\n</ul>\n<h1 id=\"trigger-æ–¹æ³•å‰–æä¸å®ç°\"><a class=\"anchor\" href=\"#trigger-æ–¹æ³•å‰–æä¸å®ç°\">#</a> trigger æ–¹æ³•å‰–æä¸å®ç°</h1>\n<h2 id=\"å®Œæ•´ä»£ç -3\"><a class=\"anchor\" href=\"#å®Œæ•´ä»£ç -3\">#</a> å®Œæ•´ä»£ç </h2>\n<figure class=\"highlight typescript\"><figcaption data-lang=\"typescript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span>target<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> key<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token keyword\">const</span> depsMap <span class=\"token operator\">=</span> targetMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>depsMap<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">const</span> effects <span class=\"token operator\">=</span> depsMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>effects<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token keyword\">const</span> effectsToRun<span class=\"token operator\">:</span> Set<span class=\"token operator\">&lt;</span>EffectFn<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  effects<span class=\"token operator\">?.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>effectFn<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>effectFn <span class=\"token operator\">!==</span> activeEffect<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      effectsToRun<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>effectFn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  effectsToRun<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>effectFnToRun<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>effectFnToRun<span class=\"token punctuation\">.</span>options<span class=\"token operator\">?.</span>scheduler<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      effectFnToRun<span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span><span class=\"token function\">scheduler</span><span class=\"token punctuation\">(</span>effectFnToRun<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token function\">effectFnToRun</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"trigger-æ¦‚è¿°\"><a class=\"anchor\" href=\"#trigger-æ¦‚è¿°\">#</a> trigger æ¦‚è¿°</h2>\n<p>ç”¨æ¥è°ƒç”¨ <code>track</code>  æ”¶é›†çš„å‰¯ä½œç”¨ï¼Œå¦‚æœæœ‰è°ƒåº¦å™¨ï¼Œåˆ™è°ƒç”¨è°ƒåº¦å™¨ã€‚</p>\n<h3 id=\"è¯¦ç»†æ­¥éª¤-3\"><a class=\"anchor\" href=\"#è¯¦ç»†æ­¥éª¤-3\">#</a> è¯¦ç»†æ­¥éª¤</h3>\n<ul>\n<li>å–å‡ºå¯¹åº”çš„ <code>target</code>  çš„å¯¹åº”çš„ <code>key</code>  çš„å¯¹åº”çš„ <code>Set</code> , å¹¶åšè¾¹ç•Œå¤„ç†\n<ol>\n<li>è°ƒç”¨ <code>targetMap.get(target)</code>  å–å‡º <code>target</code>  å¯¹åº”çš„ <code>Map</code>  èµ‹å€¼ç»™ <code>depsMap</code> ã€‚å¦‚æœ <code>depsMap</code>  ä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›</li>\n<li>è°ƒç”¨ <code>depsMap.get(key)</code>  å–å‡º <code>key</code>  å¯¹åº”çš„ <code>Set</code>  å¹¶å¤åˆ¶ç»™ <code>effects</code> ï¼Œå¦‚æœ <code>effects</code>  ä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›ã€‚</li>\n</ol>\n</li>\n<li>å®šä¹‰ä¸€ä¸ª <code>effectsToRun</code> , å°† <code>effects</code>  å­˜å‚¨çš„å‰¯ä½œç”¨å‡½æ•°å…¨éƒ¨æ·»åŠ åˆ° <code>effectsToRun</code> , ä»¥ç­‰å¾…éå† <code>effectsToRun</code>  æ‰§è¡Œå­˜å‚¨çš„æ‰€æœ‰å‰¯ä½œç”¨å‡½æ•°ã€‚ï¼ˆä¹‹æ‰€ä»¥è¿™ä¹ˆåšæ˜¯å› ä¸ºï¼Œå‰¯ä½œç”¨å‡½æ•°åœ¨æ‰§è¡Œçš„æ—¶å€™ä¼šå…ˆè°ƒç”¨ <code>clearUp</code>  å°†å…¶ä» <code>Set</code>  ä¸­åˆ é™¤ï¼Œæ‰§è¡Œ <code>fn</code>  çš„æ—¶å€™åˆä¼šå°† <code>effectFn</code>  æ·»åŠ åˆ° <code>Set</code> , è¿™æ ·å°±ä¼šé™·å…¥æ— é™å¾ªç¯ï¼Œ æ‰€ä»¥å®šä¹‰ä¸€ä¸ªæ–°çš„ <code>Set</code>  æ¥é¿å…è¿™ä¸ªé—®é¢˜ï¼‰</li>\n<li>è°ƒç”¨ <code>effectsToRun.forEach</code>  æ¥éå†å®ƒï¼Œå¹¶è°ƒç”¨å­˜å‚¨çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œä½†æ˜¯åœ¨è°ƒç”¨å‰ä¼šåšåˆ¤æ–­ï¼Œå¦‚æœ <code>effectToRun.options.scheduler</code>  å­˜åœ¨çš„è¯ï¼Œä¼šè°ƒç”¨ <code>effectToRun.options.sheduler</code>  è€Œä¸æ˜¯è°ƒç”¨ <code>effectToRun</code></li>\n</ul>\n",
            "tags": [
                "ç¬”è®°",
                "å‰ç«¯",
                "Vue",
                "VueåŸç†å®ç°",
                "å‰ç«¯",
                "Vue",
                "VueåŸç†åˆ¨æ",
                "Vueå“åº”å¼æ¨¡å—åˆ¨æ",
                "effect"
            ]
        },
        {
            "id": "https://zimu-66ccff.github.io/reactivity-reactive/",
            "url": "https://zimu-66ccff.github.io/reactivity-reactive/",
            "title": "Vueå“åº”å¼æ¨¡å—-reactivity-reactive",
            "date_published": "2023-02-14T02:21:11.000Z",
            "content_html": "<h1 id=\"ractive-æ–¹æ³•å‰–æä¸å®ç°\"><a class=\"anchor\" href=\"#ractive-æ–¹æ³•å‰–æä¸å®ç°\">#</a> ractive æ–¹æ³•å‰–æä¸å®ç°</h1>\n<h2 id=\"å®Œæ•´ä»£ç å®ç°\"><a class=\"anchor\" href=\"#å®Œæ•´ä»£ç å®ç°\">#</a> å®Œæ•´ä»£ç å®ç°</h2>\n<figure class=\"highlight typescript\"><figcaption data-lang=\"typescript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> isArray<span class=\"token punctuation\">,</span> isObject<span class=\"token punctuation\">,</span> hasChanged <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../utils/index'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> effect<span class=\"token punctuation\">,</span> track<span class=\"token punctuation\">,</span> trigger <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./effect'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">reactive</span><span class=\"token punctuation\">(</span>target<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">isObject</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> target<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isReactive</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> target<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>reactiveMap<span class=\"token punctuation\">.</span><span class=\"token function\">has</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> reactiveMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token keyword\">const</span> reactiveProxy<span class=\"token operator\">:</span> Record<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">symbol</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">any</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Proxy</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    target<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token function\">get</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key <span class=\"token operator\">===</span> <span class=\"token string\">'_isReactive'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token function\">track</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> Reflect<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">isObject</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">reactive</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> res<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token function\">set</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">,</span> newValue<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">const</span> oldValue <span class=\"token operator\">=</span> Reflect<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">const</span> oldLength <span class=\"token operator\">=</span> Reflect<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> <span class=\"token string\">'length'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> Reflect<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">,</span> newValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">hasChanged</span><span class=\"token punctuation\">(</span>oldValue<span class=\"token punctuation\">,</span> newValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>          <span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            oldLength <span class=\"token operator\">!=</span> Reflect<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> <span class=\"token string\">'length'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            key <span class=\"token operator\">!==</span> <span class=\"token string\">'length'</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>          <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> <span class=\"token string\">'length'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  reactiveMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> reactiveProxy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token keyword\">return</span> reactiveProxy<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">isReactive</span><span class=\"token punctuation\">(</span>target<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>  <span class=\"token keyword\">return</span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>target <span class=\"token operator\">&amp;&amp;</span> target<span class=\"token punctuation\">.</span>__isReactive<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"è¾¹ç•Œå¤„ç†å¯¹ç‰¹æ®Šæƒ…å†µçš„å¤„ç†\"><a class=\"anchor\" href=\"#è¾¹ç•Œå¤„ç†å¯¹ç‰¹æ®Šæƒ…å†µçš„å¤„ç†\">#</a> è¾¹ç•Œå¤„ç†ï¼ˆå¯¹<strong>ç‰¹æ®Šæƒ…å†µ</strong>çš„å¤„ç†ï¼‰</h2>\n<ul>\n<li><code>target</code>  çš„ç±»å‹ä¸ä¸º  <code>Object</code>  æ—¶ï¼š\n<ul>\n<li>åˆ©ç”¨ <code>isObject</code>  æ–¹æ³•åˆ¤æ–­ <code>target</code>  çš„ç±»å‹æ˜¯å¦ä¸º <code>Object</code></li>\n<li><code>isObject</code>  æ–¹æ³•çš„è¿”å›å€¼ä¸º <code>false</code>  æ—¶ï¼Œå³ <code>target</code>  çš„ç±»å‹ä¸ä¸º <code>Object</code> , åˆ™ç›´æ¥è¿”å› <code>target</code> , ä¸åšæ¥ä¸‹æ¥çš„å“åº”å¼å¤„ç†</li>\n</ul>\n</li>\n<li><code>target</code> <strong> æœ¬èº«</strong>å·²ç»ä¸ºä¸€ä¸ª<strong>å“åº”å¼ä»£ç†</strong>æ—¶:\n<ul>\n<li>åˆ©ç”¨ <code>isRective</code>  æ–¹æ³•åˆ¤æ–­ <code>target</code>  æ˜¯å¦ä¸º<strong>å“åº”å¼ä»£ç†</strong></li>\n<li><code>isReactive</code>  æ–¹æ³•çš„è¿”å›å€¼ä¸º <code>true</code>  æ—¶ï¼Œ å³ <code>target</code>  å·²ç»ä¸ºä¸€ä¸ª<strong>å“åº”å¼ä»£ç†</strong>ï¼Œåˆ™ç›´æ¥è¿”å› <code>target</code> ï¼Œä¸å†åšæ¥ä¸‹æ¥çš„å¤„ç†</li>\n</ul>\n</li>\n<li><code>target</code>  å·²ç»<strong>è¢«åšè¿‡å“åº”å¼ä»£ç†</strong>æ—¶:\n<ul>\n<li>åˆ©ç”¨ <code>reactiveMap.has(target)</code>  æ–¹æ³•æ¥åˆ¤æ–­ <code>target</code>  æ˜¯å¦å·²ç»è¢«åšè¿‡<strong>å“åº”å¼ä»£ç†</strong></li>\n<li><code>reactiveMap.has(target)</code>  æ–¹æ³•è¿”å›å€¼ä¸º <code>true</code>  æ—¶ï¼Œ å³ <code>target</code>  å·²ç»è¢«åšè¿‡<strong>å“åº”å¼ä»£ç†</strong>ï¼Œåˆ™ç›´æ¥è°ƒç”¨ <code>reactiveMap.get(targey)</code>  æ–¹æ³•è¿”å›<strong>å®ƒçš„å“åº”å€¼ä»£ç†</strong></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"å“åº”å¼å¤„ç†\"><a class=\"anchor\" href=\"#å“åº”å¼å¤„ç†\">#</a> å“åº”å¼å¤„ç†</h2>\n<h3 id=\"æ•´ä½“æ¦‚è¿°\"><a class=\"anchor\" href=\"#æ•´ä½“æ¦‚è¿°\">#</a> æ•´ä½“æ¦‚è¿°</h3>\n<p>åˆ©ç”¨ <code>Proxy</code>  å¯¹ <code>target</code>  åšä¸€ä¸ª<strong>æ•°æ®ä»£ç†</strong>ï¼Œæ‹¦æˆªå…¶ <code>getter</code>  and  <code>setter</code> , æœ€åè¿”å›è¿™ä¸ª<strong>æ•°æ®ä»£ç†</strong></p>\n<h3 id=\"è¯¦ç»†æ­¥éª¤\"><a class=\"anchor\" href=\"#è¯¦ç»†æ­¥éª¤\">#</a> è¯¦ç»†æ­¥éª¤</h3>\n<ul>\n<li>\n<p><strong>æ‹¦æˆª getter</strong></p>\n<ol>\n<li><em>åšè¾¹ç•Œå¤„ç†</em>\n<ul>\n<li><code>if(key === '_isReactive')</code>  åˆ¤æ–­å…¶è¦è·å–çš„ <code>key</code>  æ˜¯å¦ä¸º <code>_isReactive</code> , å½“ <code>if</code>  åˆ¤æ–­ä¸º <code>true</code>  æ—¶ï¼Œåˆ™ç›´æ¥è¿”å› <code>false</code> ï¼Œ<strong>ä¸å†è¿›è¡Œæ¥ä¸‹æ¥çš„å¤„ç†</strong></li>\n</ul>\n</li>\n<li><em>æ”¶é›†å‰¯ä½œç”¨</em>\n<ul>\n<li>è°ƒç”¨ <code>track</code>  æ–¹æ³•æ¥æ”¶é›†<strong>å‰¯ä½œç”¨å‡½æ•°</strong>ï¼Œå°†å…¶æ”¶é›†åˆ° <code>target</code>  å¯¹åº”çš„ <code>key</code>  çš„å¯¹åº”çš„ <code>Set</code>  é‡Œé¢ï¼Œç­‰å¾… <code>setter</code>  è¢«è§¦å‘ï¼Œå¹¶ä¿®æ”¹ <code>target[key]</code>  çš„æ—¶å€™è°ƒç”¨ <code>trigger</code>  æ¥å°†è¿™ä¸ª <code>Set</code>  é‡Œé¢å­˜å‚¨çš„<strong>å‰¯ä½œç”¨å‡½æ•°</strong>ä¸€ä¸€è§¦å‘.</li>\n<li><strong>ps</strong>: <em><a href=\"https://zimu-66ccff.github.io/reactivity-effect/\">(track æ–¹æ³•çš„è®²è§£è¯·ç‚¹å‡»è¿™é‡Œå¥¥)</a></em></li>\n</ul>\n</li>\n<li><em>è¿”å› <code>target[key]</code>  çš„å€¼ï¼Œåšæ·±åº¦å“åº”å¼å¤„ç†</em>\n<ul>\n<li>åˆ©ç”¨ <code>Reflect.get(target, key)</code>  å–å‡º <code>target[key]</code>  çš„å€¼</li>\n<li>åˆ¤æ–­ <code>target[key]</code>  çš„å€¼çš„ç±»å‹æ˜¯å¦ä¸º <code>Object</code> , å½“ä¸º <code>Object</code>  æ—¶ï¼Œåˆ™è¿”å› <code>reactive(target[key])</code>  å¯¹å…¶åšæ·±åº¦å“åº”å¼å¤„ç†ï¼Œå½“ä¸ä¸º <code>Object</code>  æ—¶ï¼Œåˆ™ç›´æ¥è¿”å› <code>target[key]</code></li>\n</ul>\n</li>\n</ol>\n</li>\n<li>\n<p><strong>æ‹¦æˆª setter</strong></p>\n<ol>\n<li><em>å–å‡ºç›¸å…³æ•°æ®ï¼Œ è¿›è¡Œæ›´æ–°æ“ä½œ</em>\n<ul>\n<li>åˆ©ç”¨ <code>Reflect.get</code>  æ–¹æ³•å–å‡ºæ²¡æœ‰ä¿®æ”¹å‰çš„ <code>target[key]</code>  å³ <code>oldValue</code>  and æ²¡æœ‰ä¿®æ”¹å‰çš„ <code>target[length]</code>  å³ <code>oldLength</code> , åˆ©ç”¨ <code>Reflect.set</code>  è¿›è¡Œå¯¹ <code>target[key]</code>  çš„æ›´æ–°</li>\n</ul>\n</li>\n<li><em>åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒç”¨å¯¹åº”çš„ <code>key</code>  å¯¹åº”çš„ <code>Set</code>  å­˜å‚¨çš„å‰¯ä½œç”¨å‡½æ•°</em>\n<ul>\n<li>åˆ©ç”¨ <code>hasChanged()</code>  åˆ¤æ–­æ–°æ—§å€¼æ˜¯å¦å‘ç”Ÿäº†æ”¹å˜ï¼Œå¦‚æœæ²¡æœ‰æ”¹å˜åˆ™ä¸è¿›è¡Œæ¥ä¸‹æ¥çš„å¤„ç†ã€‚å¦‚æœå‘ç”Ÿäº†æ”¹å˜ï¼Œåˆ™è°ƒç”¨ <code>trigger</code>  æ–¹æ³•ï¼Œæ¥è°ƒç”¨å¯¹åº”çš„ <code>key</code>  å¯¹åº”çš„ <code>Set</code>  å­˜å‚¨çš„å‰¯ä½œç”¨å‡½æ•°</li>\n<li><strong>ps</strong>: <em><a href=\"https://zimu-66ccff.github.io/reactivity-effect/\">trigger æ–¹æ³•çš„è®²è§£è¯·ç‚¹å‡»è¿™é‡Œå¥¥</a></em></li>\n</ul>\n</li>\n<li><em>åˆ¤æ–­ <code>target</code>  æ˜¯å¦ä¸º <code>Array</code> , å¹¶ä¸”æ•°ç»„çš„é•¿åº¦æ˜¯å¦å‘ç”Ÿäº†æ”¹å˜</em>\n<ul>\n<li>åˆ©ç”¨ <code>isArray</code>  åˆ¤æ–­ <code>target</code> ï¼Œå¹¶åˆ©ç”¨ <code>Reflect.get()</code>  å–å¾—æ›´æ–°åæ•°ç»„çš„é•¿åº¦ï¼Œå¹¶ä¸ä¹‹å‰æ•°ç»„çš„é•¿åº¦ <code>oldLength</code>  æ¯”è¾ƒï¼Œçœ‹æ˜¯å¦å‘ç”Ÿäº†æ”¹å˜ï¼Œå¦‚æœå‘ç”Ÿäº†æ”¹å˜ï¼Œåˆ™è°ƒç”¨ <code>tigger</code>  æ–¹æ³•ï¼Œæ¥è°ƒç”¨ <code>length</code>  å¯¹åº”çš„ <code>Set</code>  å­˜å‚¨çš„å‰¯ä½œç”¨ã€‚<em>ï¼ˆä¹‹æ‰€ä»¥è¦è¿™æ ·åšï¼Œæ˜¯å› ä¸ºå½“ç»™æ•°ç»„å¢åŠ  or åˆ é™¤å…ƒç´ çš„æ—¶å€™ï¼Œæ•°ç»„çš„ <code>length</code>  å°±å·²ç»æ”¹å˜äº†ï¼Œ å½“å¯¹ <code>length</code>  çš„æ›´æ–°çš„æ‹¦æˆªçš„æ—¶å€™ï¼Œå°±ä¼šå‘ç°æ–°å€¼å’Œæ—§å€¼æ˜¯ä¸€æ ·çš„ï¼Œå°±ä¸ä¼šè§¦å‘ <code>trigger</code> ï¼‰</em></li>\n</ul>\n</li>\n</ol>\n</li>\n<li>\n<p><strong>å°†å“åº”å¼ä»£ç†å­˜å‚¨èµ·æ¥ï¼Œå¹¶è¿”å›å“åº”å¼ä»£ç†</strong></p>\n<ol>\n<li>è°ƒç”¨ <code>reactiveMap.set</code>  æ–¹æ³•ï¼Œå°†å“åº”å¼ä»£ç†å’Œ <code>target</code>  å…³è”èµ·æ¥å¹¶å­˜å‚¨ï¼Œä»¥ä¾¿äºåšä¸Šæ–‡çš„<strong>è¾¹ç•Œå¤„ç†</strong> ( <code>target</code>  å·²ç»è¢«åšè¿‡å“åº”å¼ä»£ç†æ—¶)</li>\n<li><strong>è¿”å›å“åº”å¼ä»£ç†</strong></li>\n</ol>\n</li>\n</ul>\n",
            "tags": [
                "ç¬”è®°",
                "å‰ç«¯",
                "Vue",
                "VueåŸç†å®ç°",
                "å‰ç«¯",
                "Vue",
                "VueåŸç†åˆ¨æ",
                "Vueå“åº”å¼æ¨¡å—åˆ¨æ",
                "reactive"
            ]
        },
        {
            "id": "https://zimu-66ccff.github.io/promiseLearn/",
            "url": "https://zimu-66ccff.github.io/promiseLearn/",
            "title": "ç†è§£Promise",
            "date_published": "2023-02-12T10:23:50.000Z",
            "content_html": "<h1 id=\"ä¸ºä»€ä¹ˆéœ€è¦-promise\"><a class=\"anchor\" href=\"#ä¸ºä»€ä¹ˆéœ€è¦-promise\">#</a> ä¸ºä»€ä¹ˆéœ€è¦ Promiseï¼ŸğŸ¤”</h1>\n<h2 id=\"æ˜ç™½åŒæ­¥ä»»åŠ¡-and-å¼‚æ­¥ä»»åŠ¡\"><a class=\"anchor\" href=\"#æ˜ç™½åŒæ­¥ä»»åŠ¡-and-å¼‚æ­¥ä»»åŠ¡\">#</a> æ˜ç™½åŒæ­¥ä»»åŠ¡ and å¼‚æ­¥ä»»åŠ¡</h2>\n<p>é¦–å…ˆï¼Œå‰ç«¯ er ä»¬éœ€è¦æ˜ç¡®ä¸€ç‚¹ï¼Œåœ¨ js è¿™ç§å•çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯æ¨¡å‹ä¸­ï¼Œä¸€ä»¶äº‹æƒ…æ²¡åšå®Œæ˜¯ä¸èƒ½åšä¸‹ä¸€ä»¶äº‹æƒ…çš„ã€‚è¿™æ—¶å€™ç¿æ™ºçš„å‹å‹ä»¬å°±ä¼šè¯´è¿™åˆå’‹äº†å‘¢ï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿå“å˜¿ï¼Œè¿˜çœŸæœ‰é—®é¢˜ï¼Œé—®é¢˜è¿˜å¤§äº†ï¼Œè¦æ˜¯ä¸­é—´æœ‰ä¸€ä»¶äº‹æƒ…è€—æ—¶å¤ªé•¿ï¼Œå¯¼è‡´åé¢è€—æ—¶å¾ˆçŸ­çš„äº‹æƒ…åšä¸äº†æ€ä¹ˆåŠå‘¢ï¼Ÿä½ çœ‹ï¼Œè¿™ä¸å°±å µè½¦äº†ï¼Œè¿˜ä¼šå µå¾ˆä¹…ã€‚ä½†æ˜¯æˆ‘ä»¬èªæ˜çš„å‰ç«¯ er ä»¬é©¬ä¸Šå°±æœ‰äº†è§£å†³æ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆä¸ç®¡é‚£ä¸ªè€—æ—¶å¾ˆé•¿çš„äº‹æƒ…ï¼Œå…ˆåšåé¢çš„äº‹æƒ…ï¼Œæœ€åå†ç®¡è¿™ä¸ªè€—æ—¶å¾ˆé•¿çš„äº‹æƒ…ä¸å°±å®Œäº‹äº†å— ğŸ˜ã€‚<br />\nå¯¹çš„ï¼Œå°±æ˜¯è¿™ç§è§£å†³æ–¹æ¡ˆï¼Œæ•²é»‘æ¿ ğŸ˜¸ï¼Œjs ä¸­ä»£ç åˆ†ä¸ºåŒæ­¥ä»»åŠ¡å’Œå¼‚æ­¥ä»»åŠ¡ï¼Œå¼‚æ­¥ä»»åŠ¡é€šå¸¸ä¸ºé‚£ç§å¯èƒ½ä¼šè€—æ—¶å¾ˆé•¿ or éœ€è¦è§¦å‘æ¡ä»¶çš„ï¼Œä¹Ÿå°±æ˜¯å‰é¢è¯´çš„å¯èƒ½ä¼šå µè½¦ï¼Œè¿˜å µå¾ˆä¹…çš„é‚£ç§ã€‚åŒæ­¥ä»»åŠ¡å½“ç„¶å°±æ˜¯é™¤äº†å¼‚æ­¥ä»»åŠ¡ä»¥å¤–çš„ä»»åŠ¡å•¦ã€‚åœ¨ js çš„æ‰§è¡Œæœºåˆ¶ä¸­ï¼Œä¼šå…ˆæ‰§è¡ŒåŒæ­¥ä»»åŠ¡ï¼Œç­‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ã€‚</p>\n<h2 id=\"æ—©æœŸå¼‚æ­¥æ“ä½œçš„ç§ç§é—®é¢˜\"><a class=\"anchor\" href=\"#æ—©æœŸå¼‚æ­¥æ“ä½œçš„ç§ç§é—®é¢˜\">#</a> æ—©æœŸå¼‚æ­¥æ“ä½œçš„ç§ç§é—®é¢˜</h2>\n<p>æ—©æœŸ js ä¸­åªæ”¯æŒå®šä¹‰å›è°ƒå‡½æ•°æ¥è¡¨æ˜å¼‚æ­¥æ“ä½œçš„å®Œæˆï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¼šä»¥ setTimeout è¿™ä¸ªå¼‚æ­¥æ“ä½œä¸ºä¾‹å­è¿›è¡Œè®²è§£ã€‚<br />\nè¯•æƒ³è¿™æ ·çš„ä¸€ç§åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ setTimeout ä¸­ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œåœ¨å‡ ç§’åæ‰§è¡Œï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œå®ƒæœ‰æ˜æ˜¾çš„è§¦å‘æ¡ä»¶ï¼Œæ—¶é—´ã€‚è¿™ä¸ªå›è°ƒå‡½æ•°ä¸­æˆ‘ä»¬ä¼šè¿›è¡Œæ—¶é—´åˆ°äº†åæˆ‘ä»¬å¸Œæœ›è¿›è¡Œçš„æ“ä½œï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è¿™ä¸ªå›è°ƒå‡½æ•°å¸Œæœ›å¯¹å¤–è¿”å›ä¸€ä¸ªæ•°æ®ï¼Œä»¥ä¾¿äºè¿›ä¸€æ­¥çš„å¤„ç†æ€ä¹ˆåŠï¼ŸğŸ¤” è¿™æ—¶å€™ä½ å°±ä¼šå‘ç°é—®é¢˜ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥è¿”å›æ•°æ®ã€‚å¥½çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚å…¶å®è¿˜æœ‰æ›´ä¸¥é‡çš„é—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬è¿›ä¸€æ­¥çš„æ“ä½œä¹Ÿæ˜¯å¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚ä¹Ÿæ˜¯åœ¨å‡ ç§’åæ‰§è¡Œæ€ä¹ˆåŠï¼Œä½ ä¼šæƒ³åˆ°ï¼Œå†ä½¿ç”¨ä¸€æ¬¡ setTimeoutï¼Œå†ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚é‚£ä¹ˆç°åœ¨å›è°ƒå‡½æ•°é‡Œé¢åˆåµŒå¥—äº†ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå¦‚æœè¿˜è¦è¿›ä¸€æ­¥æ“ä½œå‘¢ï¼Œè¿˜æ˜¯å¼‚æ­¥æ“ä½œå‘¢ï¼Œå†åµŒå¥—ï¼ŒåµŒå¥—ï¼ŒåµŒå¥—ï¼ŒåµŒå¥—ï¼Œæœ€åä½ ä¸€ä¸ªå›è°ƒå‡½æ•°é‡Œé¢åµŒå¥—äº† n ä¸ªå‡½æ•°ï¼Œæœ€åçš„åœºæ™¯æ˜¯ä»€ä¹ˆæ ·å­å‘¢ã€‚å›è°ƒåœ°ç‹±ï¼ï¼ï¼è¯·çœ‹ä¸‹å›¾ã€‚<br />\n<img data-src=\"https://i.328888.xyz/2023/02/12/cwAbF.png\" alt=\"å›è°ƒåœ°ç‹±\" /></p>\n<p>ç›¸ä¿¡å‰ç«¯ er çœ‹åˆ°ç±»ä¼¼è¿™ç§ä»£ç ï¼Œè¡€å‹æ˜¯é©¬ä¸Šå°±ä¼šä¸Šå‡çš„ï¼Œæ‰€ä»¥å¯ä¸è¦å†™è¿™ç§ä»£ç å¥¥ã€‚</p>\n<p>å®é™…ä¸Šå¼‚æ­¥æ“ä½œçš„é—®é¢˜å¯ä¸æ­¢è¿™äº›ï¼Œæ¯”å¦‚å¦‚æœå¼‚æ­¥æ“ä½œå¤±è´¥äº†ï¼Œæ€ä¹ˆè¿›è¡Œåç»­çš„å¤„ç†ï¼Œæ€ä¹ˆæ‹¿åˆ°å¤±è´¥çš„åŸå› ï¼Œè¿™éƒ½æ˜¯éœ€è¦è§£å†³çš„ã€‚<br />\né‚£ä¹ˆä¸ºäº†è§£å†³ï¼Œå¦‚ä½•æ‹¿åˆ°è¿”å›å€¼ï¼› å¼‚æ­¥æ“ä½œå¤±è´¥åå¦‚ä½•æ‹¿åˆ°å¤±è´¥çš„åŸå› ï¼Œå¹¶è¿›ä¸€æ­¥å¤„ç†ï¼›å¦‚ä½•é¿å…å›è°ƒåœ°ç‹±ï¼›Promise åº”è¿è€Œç”Ÿ ğŸ˜</p>\n<h1 id=\"promise-æ˜¯ä»€ä¹ˆ\"><a class=\"anchor\" href=\"#promise-æ˜¯ä»€ä¹ˆ\">#</a> Promise æ˜¯ä»€ä¹ˆï¼ŸğŸ¤”</h1>\n<p>Promise æ˜¯ä¸€ç§å¼‚æ­¥ç¼–ç¨‹æœºåˆ¶ï¼Œæ˜¯å¯¹å›è°ƒåœ°ç‹±çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚<br />\nPromise å®åˆ—åˆ™æ˜¯ä¸€ç§çŠ¶æ€æœºï¼Œå®ƒæœ‰ä¸‰ç§åŸºæœ¬çŠ¶æ€ï¼Œå¾…å®šï¼ˆpendingï¼‰ï¼Œå…‘ç°ï¼ˆfulfilled)ï¼Œ æ‹’ç» (rejected)ï¼Œæœ€åˆçš„çŠ¶æ€ä¸º pendingï¼ŒçŠ¶æ€ä¸€æ—¦æ”¹å˜ï¼Œå°±å®šäº†ï¼Œå°±ä¸ä¼šå†å‘ç”Ÿä»»ä½•æ”¹å˜äº†ã€‚</p>\n<h1 id=\"promise-æ˜¯æ€ä¹ˆè§£å†³æ—©æœŸå¼‚æ­¥æ“ä½œçš„ç–‘éš¾æ‚ç—‡çš„\"><a class=\"anchor\" href=\"#promise-æ˜¯æ€ä¹ˆè§£å†³æ—©æœŸå¼‚æ­¥æ“ä½œçš„ç–‘éš¾æ‚ç—‡çš„\">#</a> Promise æ˜¯æ€ä¹ˆè§£å†³æ—©æœŸå¼‚æ­¥æ“ä½œçš„ç–‘éš¾æ‚ç—‡çš„ ğŸ¤”</h1>\n<h2 id=\"è§£å†³å¦‚ä½•æ‹¿åˆ°è¿”å›å€¼å½“å¼‚æ­¥æ“ä½œå¤±è´¥åå¦‚ä½•æ‹¿åˆ°å¤±è´¥çš„åŸå› å¹¶è¿›ä¸€æ­¥å¤„ç†çš„é—®é¢˜\"><a class=\"anchor\" href=\"#è§£å†³å¦‚ä½•æ‹¿åˆ°è¿”å›å€¼å½“å¼‚æ­¥æ“ä½œå¤±è´¥åå¦‚ä½•æ‹¿åˆ°å¤±è´¥çš„åŸå› å¹¶è¿›ä¸€æ­¥å¤„ç†çš„é—®é¢˜\">#</a> è§£å†³å¦‚ä½•æ‹¿åˆ°è¿”å›å€¼ï¼›å½“å¼‚æ­¥æ“ä½œå¤±è´¥åå¦‚ä½•æ‹¿åˆ°å¤±è´¥çš„åŸå› ï¼Œå¹¶è¿›ä¸€æ­¥å¤„ç†çš„é—®é¢˜</h2>\n<p>æ„é€ å‡½æ•° Promiseï¼ˆï¼‰ä¸­å¯ä»¥ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°è¿™ä¸ªå›è°ƒå‡½æ•°ä¸ºæ‰§è¡Œå™¨å‡½æ•°ï¼Œæ‰§è¡Œå™¨å‡½æ•°ä¸»è¦æœ‰ä¸¤é¡¹èŒè´£ï¼š1. åˆå§‹åŒ–æœŸçº¦çš„å¼‚æ­¥è¡Œä¸ºï¼ˆåœ¨æ‰§è¡Œå™¨å‡½æ•°ä¸­è¿›è¡Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„å¼‚æ­¥æ“ä½œï¼‰å’Œæ§åˆ¶çŠ¶æ€çš„æœ€ç»ˆè½¬æ¢ï¼ˆå°† Promise å®åˆ—çš„çŠ¶æ€ç”±æœ€åˆçš„ pending è½¬æ¢ä¸º fulfilled or rejectedï¼‰ã€‚é‚£ä¹ˆå®ƒæ˜¯æ€ä¹ˆæ¥æ§åˆ¶çŠ¶æ€çš„æœ€ç»ˆè½¬æ¢çš„å‘¢ï¼ŸğŸ¤” å¾ˆç®€å•ï¼Œè¿™ä¸ªæ‰§è¡Œå™¨å‡½æ•°æ˜¯è‡ªå¸¦ä¸¤ä¸ªå‚æ•°çš„ï¼Œè¿™ä¸¤ä¸ªå‚æ•°éƒ½ä¸ºå‡½æ•°ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°ä¸º resolveï¼Œ rejectã€‚ä½ å¯ä»¥åœ¨ resolve ä¸­ä¼ é€’å‚æ•°ï¼Œæ¥è¿”å›ä½ éœ€è¦çš„æ•°æ®ï¼›å¯ä»¥åœ¨ reject ä¸­ä¼ é€’å‚æ•°ï¼Œæ¥è¿”å›å¼‚æ­¥æ“ä½œå¤±è´¥çš„åŸå› ã€‚å½“ä½ åœ¨æ‰§è¡Œå™¨å‡½æ•°ä¸­è°ƒç”¨ resolveï¼ŒPromise å®åˆ—çš„çŠ¶æ€å°±ç”± pending å˜ä¸ºäº† fulfilledï¼ˆæ³¨ï¼šè¿™é‡Œä¸æ˜¯ååˆ†å‡†ç¡®ï¼Œéœ€è¦æ ¼å¤–æ³¨æ„ä¸€ç§ç‰¹åˆ«æƒ…å†µï¼Œå¦‚æœè¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ª Promiseï¼Œé‚£ä¹ˆ Promise å®åˆ—çš„çŠ¶æ€å°†ç”±è¿”å›çš„è¿™ä¸ª Promise å†³å®šï¼Œä¸ºè¿™ä¸ª Promise çš„çŠ¶æ€ï¼Œä¸ä¸€å®šä¸º fulfilledï¼‰ï¼›åŒç†ï¼Œå½“ä½ è°ƒç”¨äº† rejectï¼ŒPromise å®åˆ—çš„çŠ¶æ€å°±ç”± pending å˜ä¸ºäº† rejectedã€‚<br />\né€šè¿‡æ‰§è¡Œå™¨å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°å‡½æ•°ï¼Œresolveï¼Œreject æˆ‘ä»¬æˆåŠŸçš„è§£å†³äº†å¦‚ä½•æ‹¿åˆ°è¿”å›å€¼ï¼Œå¼‚æ­¥æ“ä½œç»“æŸåæ‹¿åˆ°å¤±è´¥çš„åŸå› çš„é—®é¢˜ã€‚<br />\né‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥ï¼Œè§£å†³æ€ä¹ˆè¿›ä¸€æ­¥å¤„ç†çš„é—®é¢˜ã€‚è¿™é‡Œæˆ‘ä»¬å°±éœ€è¦çŸ¥é“ Promise å®åˆ—ä¸Šé¢å…¶å®æ˜¯ç”±ä¸€ä¸ª then æ–¹æ³•çš„ï¼Œä¸è¿‡å…¶å®è¿™ä¸ªæ–¹æ³•æ˜¯å®šä¹‰åœ¨ Promise å®åˆ—çš„æ„é€ å‡½æ•°çš„åŸå‹ä¸Šé¢çš„ã€‚è¿™ä¸ª then æ–¹æ³•ä¸€æ ·æœ‰ä¸¤ä¸ªå‚æ•°å‡½æ•°ï¼Œä¸€èˆ¬ç§°ä¸º onResolved, onRejectedã€‚å½“ promise å®åˆ—çš„çŠ¶æ€ä¸º fulfilled çš„æ—¶å€™ï¼Œå°±ä¼šæ‰§è¡Œç¬¬ä¸€ä¸ªå‚æ•°å‡½æ•°ï¼Œå³ onResolvedï¼›å½“ promise å®åˆ—çš„çŠ¶æ€ä¸º rejected çš„æ—¶å€™ï¼Œå°±ä¼šæ‰§è¡Œç¬¬äºŒä¸ªå‚æ•°å‡½æ•°ï¼Œå³ onRejectedã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸¤ä¸ªå‚æ•°å‡½æ•°ä¸­å†™å…¥å¯¹åº”çš„è¿›ä¸€æ­¥å¤„ç†çš„é€»è¾‘ã€‚<br />\nè‡³æ­¤ï¼Œæˆ‘ä»¬å°±è§£å†³äº†å¦‚ä½•æ‹¿åˆ°è¿”å›å€¼ï¼Œæ‹¿åˆ°å¼‚æ­¥æ“ä½œå¤±è´¥çš„æ—¶å€™å¤±è´¥çš„åŸå› ï¼Œå¹¶è¿›ä¸€æ­¥å¤„ç†çš„é—®é¢˜ãƒ½ (âœ¿ ï¾Ÿ â–½ ï¾Ÿ) ãƒ ğŸ˜</p>\n<h2 id=\"è§£å†³å›è°ƒåœ°ç‹±çš„é—®é¢˜\"><a class=\"anchor\" href=\"#è§£å†³å›è°ƒåœ°ç‹±çš„é—®é¢˜\">#</a> è§£å†³å›è°ƒåœ°ç‹±çš„é—®é¢˜</h2>\n<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦çŸ¥é“ promise å®åˆ—èº«ä¸Šçš„ then æ–¹æ³•æ˜¯ä¼šè¿”å›ä¸€ä¸ª promise å®åˆ—çš„ï¼Œè¿”å›çš„è¿™ä¸ªæ–°çš„å®åˆ—æ˜¯åŸºäº onResolved å‡½æ•° or onRejected å‡½æ•°çš„è¿”å›å€¼æ„å»ºçš„ï¼Œæ˜¯å°†è¿”å›å€¼ä¼ é€’ç»™ Promise.resolve å‡½æ•°æ¥åŒ…è£…ç”Ÿæˆæ–°çš„ promise å®åˆ—ã€‚</p>\n<ul>\n<li>1. å½“è§¦å‘çš„ onResolved or onRejected å‡½æ•°æ²¡æœ‰è¿”å›å€¼æ—¶ï¼Œä¼šé»˜è®¤è¿”å› undefined æ¥ä¼ é€’ç»™ Promise.resolve å‡½æ•°æ¥ç”Ÿæˆæ–°çš„æˆåŠŸçš„ promise å®åˆ—ã€‚</li>\n<li>2. å½“æœ‰è¿”å›å€¼çš„æ—¶å€™ä¼šå°†è¿”å›å€¼ä¼ é€’ç»™ Promise.resolve å‡½æ•°æ¥ç”Ÿæˆæ–°çš„æˆåŠŸçš„ promise å®åˆ—ã€‚</li>\n<li>3. å½“è¿”å›å€¼ä¸ºä¸€ä¸ª promise å®åˆ—çš„æ—¶å€™ä¼šå°†è¯¥ promise å®åˆ—ä¼ é€’ Promise.resolve å‡½æ•°æ¥è¿”å›è¯¥ promise å®åˆ—ã€‚</li>\n<li>4. å½“åœ¨è§¦å‘çš„ onResolved or onRejected å‡½æ•°ä¸­æŠ›å‡ºäº†ä¸€ä¸ªé”™è¯¯æ—¶ï¼Œä¼šå°†è¯¥é”™è¯¯ä¼ é€’ç»™ promise.resolve æ¥è¿”å›ä¸€ä¸ªæ–°çš„å¤±è´¥çš„ promise å®åˆ—ã€‚</li>\n<li>5. å½“å‹æ ¹æ²¡æœ‰éœ€è¦è§¦å‘çš„ onResolved or onRejected å‡½æ•°æ—¶ï¼Œä¼šå°†è°ƒç”¨ then æ–¹æ³•çš„ Promise å®åˆ—åŸæ ·è¿”å›ã€‚</li>\n</ul>\n<p>ç”±äº then æ–¹æ³•å›ºå®šä¼šè¿”å› promise å®åˆ—ï¼Œè¿™å°±ä¸ºé“¾å¼è°ƒç”¨æä¾›äº†å¯èƒ½ï¼Œè€Œé“¾å¼è°ƒç”¨ä¾¿å¯ç»™åµŒå¥—è§£å¥—ï¼Œé¿å…åµŒå¥—ï¼Œè§£å†³å›è°ƒåœ°ç‹±ã€‚<br />\nè‡³æ­¤ï¼Œä¹Ÿè§£å†³äº†å›è°ƒåœ°ç‹±çš„é—®é¢˜ã€‚è¯·çœ‹ä¸‹å›¾ ğŸ˜<br />\n<img data-src=\"https://i.328888.xyz/2023/02/12/cwD6H.png\" alt=\"è§£å†³å›è°ƒåœ°ç‹±\" /></p>\n<p>å½“ç„¶ï¼ŒPromise è¿˜æœ‰å¾ˆå¤šçš„å®åˆ—æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å°±ä¸ä¸€ä¸€è®²è§£ï¼Œè¯»è€…ä»¬ä¸‹å»äº†å¯ä»¥è‡ªè¡Œäº†è§£ã€‚</p>\n<h1 id=\"æ‰‹å†™-promise-çš„å®ç°\"><a class=\"anchor\" href=\"#æ‰‹å†™-promise-çš„å®ç°\">#</a> æ‰‹å†™ Promise çš„å®ç°</h1>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token constant\">PENDING</span> <span class=\"token operator\">=</span> <span class=\"token function\">Symbol</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pending'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token constant\">RESOLVE</span> <span class=\"token operator\">=</span> <span class=\"token function\">Symbol</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resolve'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token constant\">REJECT</span> <span class=\"token operator\">=</span> <span class=\"token function\">Symbol</span><span class=\"token punctuation\">(</span><span class=\"token string\">'reject'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">myPromise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fn</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token keyword\">const</span> instance <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token constant\">PENDING</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>resolvedCallbacks <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rejectedCallbacks <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token keyword\">function</span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>value <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">myPromise</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token keyword\">return</span> value<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>instance<span class=\"token punctuation\">.</span>state <span class=\"token operator\">===</span> <span class=\"token constant\">PENDING</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        instance<span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token constant\">RESOLVE</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        instance<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        instance<span class=\"token punctuation\">.</span>resolvedCallbacks<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">callback</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token keyword\">function</span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      instance<span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token constant\">REJECT</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      instance<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> err<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      instance<span class=\"token punctuation\">.</span>rejectedCallbacks<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">callbacks</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">callbacks</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token function\">fn</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>myPromise<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">then</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">onResolved<span class=\"token punctuation\">,</span> onRejected</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>  <span class=\"token keyword\">const</span> self <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">myPromise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">resolved</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">onResolved</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token keyword\">return</span> result <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">myPromise</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>          <span class=\"token operator\">?</span> result<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>              <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>              <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>          <span class=\"token operator\">:</span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">rejected</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">onRejected</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>        <span class=\"token keyword\">return</span> result <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">myPromise</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>          <span class=\"token operator\">?</span> result<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>              <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>              <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>            <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>          <span class=\"token operator\">:</span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>      <span class=\"token keyword\">case</span> <span class=\"token constant\">PENDING</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>        self<span class=\"token punctuation\">.</span>resolvedCallbacks<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>onResolved<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>        self<span class=\"token punctuation\">.</span>rejectedCallbacks<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>onRejected<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>      <span class=\"token keyword\">case</span> <span class=\"token constant\">RESOLVE</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>        <span class=\"token function\">resolved</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>      <span class=\"token keyword\">case</span> <span class=\"token constant\">REJECT</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>        <span class=\"token function\">rejected</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure>",
            "tags": [
                "ç¬”è®°",
                "å‰ç«¯",
                "JavaScript",
                "å‰ç«¯",
                "JSé«˜çº§",
                "Promise"
            ]
        },
        {
            "id": "https://zimu-66ccff.github.io/mySelf/",
            "url": "https://zimu-66ccff.github.io/mySelf/",
            "title": "å…³äºæˆ‘",
            "date_published": "2023-02-11T05:49:30.000Z",
            "content_html": "<p>ä¸€åªå‰ç«¯å°ç™½</p>\n",
            "tags": [
                "éšç¬”",
                "è‡ªæˆ‘"
            ]
        }
    ]
}