{
    "version": "https://jsonfeed.org/version/1",
    "title": "æœ¨å­äº­",
    "subtitle": "é‚£å¹´æ»¡èº«ç°ç™½ï¼Œå”¯æ­¤äº­æº¢å½©ï¼Œä»Šæ—¥ä¸æŸ“å°˜åŸƒï¼Œé™åæ­¤äº­ç›¸ä¼´",
    "icon": "https://zimu-66ccff.github.io/images/favicon.ico",
    "description": "å¹²å‡€æ¾„æ¾ˆï¼ŒçœŸè¯šè‡ªç„¶",
    "home_page_url": "https://zimu-66ccff.github.io",
    "items": [
        {
            "id": "https://zimu-66ccff.github.io/promiseWrite/",
            "url": "https://zimu-66ccff.github.io/promiseWrite/",
            "title": "æ‰‹å†™PromiseåŠå…¶ç›¸å…³æ–¹æ³•",
            "date_published": "2023-02-16T08:02:20.000Z",
            "content_html": "<h1 id=\"æ‰‹å†™-promise\"><a class=\"anchor\" href=\"#æ‰‹å†™-promise\">#</a> æ‰‹å†™ promise</h1>\n<h2 id=\"å®Œæ•´ä»£ç \"><a class=\"anchor\" href=\"#å®Œæ•´ä»£ç \">#</a> å®Œæ•´ä»£ç </h2>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token constant\">PENDING</span> <span class=\"token operator\">=</span> <span class=\"token function\">Symbol</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pending'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token constant\">FULFILL</span> <span class=\"token operator\">=</span> <span class=\"token function\">Symbol</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resolve'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token constant\">REJECT</span> <span class=\"token operator\">=</span> <span class=\"token function\">Symbol</span><span class=\"token punctuation\">(</span><span class=\"token string\">'reject'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">myPromise</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">executor</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">/* åˆå§‹åŒ– promise pending çŠ¶æ€ */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>status <span class=\"token operator\">=</span> <span class=\"token constant\">PENDING</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">/* è®°å½•å½“å‰ promise å…‘ç°å€¼å’Œæ‹’å›  */</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>reason <span class=\"token operator\">=</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">/* </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      è®°å½•å½“å‰ promise çš„ fulfilled ä¸ rejected å›è°ƒ</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      ä½¿ç”¨æ•°ç»„æ˜¯å› ä¸ºä¸€ä¸ª promise å¯ä»¥æ¥å—å¤šæ¬¡ then,catch å›è°ƒï¼Œå¦åˆ™åªéœ€å„å­˜å‚¨ä¸€ä¸ªå‡½æ•°å³å¯</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>onFulFilledFns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>onRejectedFns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">resolve</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token comment\">/* </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        æ­¤å¤„å­˜åœ¨ä¸¤æ¬¡åˆ¤æ–­ promise çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯æ‰§è¡Œ executor å’Œæ‰§è¡Œå¾®ä»»åŠ¡æ—¶</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        ä¿è¯ promise çŠ¶æ€ä¸€ç»ç¡®å®šä¸å†æ”¹å˜</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      */</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token constant\">PENDING</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token comment\">/* resolve æ–¹æ³•å¤„ç† promise å’Œ thenable ç‰¹æ®Šå‚æ•° */</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          value <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">myPromise</span> <span class=\"token operator\">||</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>          <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> value <span class=\"token operator\">===</span> <span class=\"token string\">'object'</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token keyword\">typeof</span> value<span class=\"token punctuation\">.</span>then <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>          <span class=\"token keyword\">return</span> value<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token comment\">/* ä½¿ç”¨å¾®ä»»åŠ¡ APIï¼ŒåŠ å…¥åˆ°å¾®ä»»åŠ¡æ ˆä¸­ */</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token function\">queueMicrotask</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token constant\">PENDING</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>status <span class=\"token operator\">=</span> <span class=\"token constant\">FULFILL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token comment\">/* æ‰§è¡Œ fulfilled å›è°ƒ */</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>onFulFilledFns<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fn</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>              <span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">reject</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">reason</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token constant\">PENDING</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token function\">queueMicrotask</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token constant\">PENDING</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>status <span class=\"token operator\">=</span> <span class=\"token constant\">REJECT</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>reason <span class=\"token operator\">=</span> reason<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>onRejectedFns<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fn</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>              <span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>reason<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token comment\">/* æ­¤å¤„æ•è· executor æ‰§è¡Œä¸­æŠ›å‡ºçš„é”™è¯¯ï¼Œè‹¥å­˜åœ¨é”™è¯¯åˆ™ promise å˜æˆæ‹’ç»çŠ¶æ€ */</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>      <span class=\"token function\">executor</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>      <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>  <span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">onFulFilledFn<span class=\"token punctuation\">,</span> onRejectedFn</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    <span class=\"token comment\">/* æ ¹æ® Promise A + æ ‡å‡†ï¼Œè‹¥å›è°ƒä¸ä¸ºå‡½æ•°ç±»å‹åˆ™å¿½è§†ï¼Œé»˜è®¤å€¼å›è°ƒä¼šå°†çŠ¶æ€ç»§ç»­ä¼ å…¥ä¸‹ä¸€ä¸ª promise ä¸­ */</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>    onFulFilledFn <span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>      <span class=\"token keyword\">typeof</span> onFulFilledFn <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span> <span class=\"token operator\">?</span> <span class=\"token function-variable function\">onFulFilledFn</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>    onRejectedFn <span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>      <span class=\"token keyword\">typeof</span> onRejectedFn <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>        <span class=\"token operator\">?</span> <span class=\"token function-variable function\">onRejectedFn</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>        <span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>            <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>    <span class=\"token comment\">/* then æ–¹æ³•è¿”å›å€¼æ˜¯ä¸€ä¸ªæ–° promise */</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">myPromise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>      <span class=\"token comment\">/* è‹¥æ•è·å½“å‰ promise å·²ç»æ”¹å˜çŠ¶æ€ï¼Œåˆ™ç›´æ¥è°ƒç”¨å›è°ƒ */</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token constant\">FULFILL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>        <span class=\"token comment\">/* æ•è· fulfilled å›è°ƒé”™è¯¯ï¼Œæ•è·åˆ°åˆ™æ”¹å˜æ–° promise çŠ¶æ€ä¸ºæ‹’ç»çŠ¶æ€ */</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>          <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token function\">onFulFilledFn</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>          <span class=\"token comment\">/* è¿”å›å€¼ä¼ é€’ç»™ä¸‹ä¸€ä¸ª fulfilled å›è°ƒ */</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>          <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>          <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token constant\">REJECT</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>          <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token function\">onRejectedFn</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>reason<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>          <span class=\"token comment\">/* è¿”å›å€¼ä¼ é€’ç»™ä¸‹ä¸€ä¸ª fulfilled å›è°ƒ */</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>          <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>          <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>      <span class=\"token comment\">/* è‹¥å½“å‰ promise æ²¡æ”¹å˜çŠ¶æ€ / æ”¹å˜çŠ¶æ€çš„å¼‚æ­¥è¿˜æœªæ‰§è¡Œï¼Œå…ˆå‚¨å­˜å›è°ƒ */</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token constant\">PENDING</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>onFulFilledFns<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>          <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>            <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token function\">onFulFilledFn</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>            <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>            <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>onRejectedFns<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>          <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>            <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token function\">onRejectedFn</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>reason<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>            <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>            <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>  <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>onRejectedFn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>    <span class=\"token comment\">/* catch æ–¹æ³•ç±»ä¼¼ then æ–¹æ³•çš„è¯­æ³•ç³– */</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span> onRejectedFn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>  <span class=\"token function\">finally</span><span class=\"token punctuation\">(</span>onFinallyFn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>    <span class=\"token comment\">/* finally æ— ä»»ä½•å½±å“ï¼Œä»…å•ç‹¬è°ƒç”¨ï¼Œä¸”æ— ä»»ä½•å‚æ•° */</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre>      <span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>        <span class=\"token function\">onFinallyFn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>        <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre>      <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>        <span class=\"token function\">onFinallyFn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"140\"></td><td><pre>        <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre>    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"143\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"æ„é€ å‡½æ•°-constructor-è®²è§£\"><a class=\"anchor\" href=\"#æ„é€ å‡½æ•°-constructor-è®²è§£\">#</a> æ„é€ å‡½æ•° constructor è®²è§£</h2>\n<ul>\n<li>\n<p>åˆå§‹åŒ–ç›¸å…³å±æ€§</p>\n<ol>\n<li>\n<p>åˆå§‹åŒ–çŠ¶æ€ status</p>\n<ul>\n<li><code>this.status = PENDING</code>  å°†çŠ¶æ€åˆå§‹åŒ–ä¸º <code>PENDING</code></li>\n</ul>\n</li>\n<li>\n<p>ä¿å­˜ promise æˆåŠŸæ—¶çš„è¦ä¼ é€’çš„å€¼ value å’Œå¤±è´¥æ—¶çš„åŸå›  reason</p>\n<ul>\n<li><code>this.value = undefined</code> ,  <code>this.reason = undefind</code>  åˆå§‹åŒ– <code>value</code>  and  <code>reason</code>  ç”¨æ¥ä¿å­˜æˆåŠŸæ—¶è¦ä¼ é€’çš„å€¼ï¼Œå’Œå¤±è´¥æ—¶è¦ä¼ é€’çš„åŸå› </li>\n</ul>\n</li>\n<li>\n<p>è®¾è®¡ onFullfilledFns, onRejectedFns ä¸¤ä¸ªæ•°ç»„</p>\n<ul>\n<li><code>this.onFullfilledFns = []</code> ,  <code>this,onRejectedFns = []</code> ï¼Œåˆå§‹åŒ– <code>onFullfilledFns</code> , <code>onRejectedFns</code>  æ¥å­˜å‚¨æˆåŠŸæ—¶å’Œå¤±è´¥æ—¶è¦è§¦å‘çš„ <code>callback</code> ã€‚</li>\n</ul>\n</li>\n</ol>\n</li>\n<li>\n<p>è®¾è®¡ resolve å‡½æ•°</p>\n<ol>\n<li>\n<p>åˆ¤æ–­å½“å‰ promise çš„çŠ¶æ€</p>\n<ul>\n<li><code>if (this.status === PENDING)</code>  åˆ¤æ–­å½“å‰ promise çš„çŠ¶æ€æ˜¯å¦ä¸º <code>PENDING</code></li>\n<li>æ˜¯çš„è¯ï¼Œåˆ™è¿›è¡Œæ¥ä¸‹æ¥çš„æ“åš</li>\n<li>ä¸æ˜¯çš„è¯ï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸åšï¼ˆå› ä¸º promise çš„çŠ¶æ€ä¸€æ—¦ç¡®å®šå°±ä¸èƒ½å†æ›´æ”¹ã€‚ï¼‰</li>\n</ul>\n</li>\n<li>\n<p>åˆ¤æ–­ value æ˜¯å¦ä¸º promise or thenabale</p>\n<ul>\n<li><code>if (value instanceof myPromise || typeof value.then === 'function')</code>  åˆ¤æ–­ value æ˜¯å¦ä¸º promise or thenableã€‚</li>\n<li>æ˜¯çš„è¯ï¼Œ <code>return value.then(resolve, reject)</code>  åˆ™è°ƒç”¨ value çš„ <code>then</code>  æ–¹æ³•å¹¶å°† <code>resolve</code>  å’Œ <code>reject</code>  ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œ å¹¶ç»“æŸ resolve å‡½æ•°çš„è°ƒç”¨ï¼Œä¸å†è¿›è¡Œæ¥ä¸‹æ¥çš„æ“ä½œã€‚è¿™æ ·å½“ value çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶å°±ä¼šè§¦å‘ <code>resolve</code>  or  <code>reject</code>  æ¥ä¿®æ”¹ç°åœ¨è¿™ä¸ª promise çš„çŠ¶æ€ã€‚ï¼ˆå› ä¸ºå½“ <code>resolve</code>  çš„ <code>value</code>  ä¸º promise or thenable çš„æ—¶å€™ï¼Œå½“å‰ promise çš„çŠ¶æ€å°†éš value çš„çŠ¶æ€æ”¹å˜è€Œæ”¹å˜ï¼Œå¹¶ä¿æŒä¸€è‡´ï¼‰ã€‚</li>\n<li>ä¸æ˜¯çš„è¯ï¼Œåˆ™è¿›è¡Œæ¥ä¸‹æ¥çš„æ“ä½œ</li>\n</ul>\n</li>\n<li>\n<p>å°† promise çŠ¶æ€çš„æ›´æ”¹ï¼Œä»¥åŠ promise çŠ¶æ€æ›´æ”¹æ—¶è¦è§¦å‘çš„å“åº”çš„å›è°ƒå‡½æ•°çš„è§¦å‘æ“ä½œï¼Œæ”¾è¿›å¾®ä»»åŠ¡é‡Œé¢</p>\n<ul>\n<li>è°ƒç”¨ <code>queueMicrotask()</code>  å°†æ¥ä¸‹æ¥çš„æ“ä½œæ³¨å†Œä¸ºå¾®ä»»åŠ¡æ”¾è¿›å¾®ä»»åŠ¡é˜Ÿåˆ—</li>\n<li><code>this.status === PENDING</code>  åˆ¤æ–­å½“å‰ promise çš„çŠ¶æ€æ˜¯å¦ä¸º PENDINGï¼Œæ˜¯çš„è¯è¿›è¡Œæ¥ä¸‹æ¥çš„æ“ä½œï¼Œä¸æ˜¯çš„è¯ï¼Œåˆ™ä¸åšæ¥ä¸‹æ¥çš„æ“ä½œï¼ˆè¿™æ ·åšä¹Ÿæ˜¯ä¸ºäº†ä¿è¯ promise çš„çŠ¶æ€ä¸€æ—¦ç¡®å®šå°±ä¸å†æ”¹å˜ï¼‰</li>\n<li><code>this.status = FULLFILL</code> ,  <code>this.value = value</code> , å°† promise çš„çŠ¶æ€ä¿®æ”¹ä¸ºæˆåŠŸï¼Œå¹¶å°†æˆåŠŸçš„å€¼ value èµ‹å€¼ç»™ promise.valueã€‚</li>\n<li><code>this.onFullfilledFns.forEach((fn) =&gt; fn(this.value))</code>  éå† <code>onFullfilledFns</code> ï¼Œå°†å…¶ä¸­å­˜å‚¨çš„æˆåŠŸæ—¶çš„ <code>callback</code>  å…¨éƒ¨è°ƒç”¨ï¼Œå¹¶å°† <code>this.value</code>  ä½œä¸ºå‚æ•°èµ‹å€¼</li>\n</ul>\n</li>\n</ol>\n</li>\n<li>\n<p>è®¾è®¡ rejeted å‡½æ•°</p>\n<ol>\n<li>\n<p>åˆ¤æ–­å½“å‰ promise çš„çŠ¶æ€</p>\n<ul>\n<li><code>if (this.status === PENDING)</code>  åˆ¤æ–­å½“å‰ promise çš„çŠ¶æ€æ˜¯å¦ä¸º <code>PENDING</code></li>\n<li>æ˜¯çš„è¯ï¼Œåˆ™è¿›è¡Œæ¥ä¸‹æ¥çš„æ“ä½œ</li>\n<li>ä¸æ˜¯çš„è¯ï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸åšï¼ˆå› ä¸º promise çš„çŠ¶æ€ä¸€æ—¦ç¡®å®šå°±ä¸èƒ½å†æ›´æ”¹ã€‚ï¼‰</li>\n</ul>\n</li>\n<li>\n<p>å°† promise çŠ¶æ€çš„æ›´æ”¹ï¼Œä»¥åŠ promise çŠ¶æ€æ›´æ”¹æ—¶è¦è§¦å‘çš„å“åº”çš„å›è°ƒå‡½æ•°çš„è§¦å‘æ“ä½œï¼Œæ”¾è¿›å¾®ä»»åŠ¡é‡Œé¢</p>\n<ul>\n<li>è°ƒç”¨ <code>queueMicrotask()</code>  å°†æ¥ä¸‹æ¥çš„æ“ä½œæ³¨å†Œä¸ºå¾®ä»»åŠ¡æ”¾è¿›å¾®ä»»åŠ¡é˜Ÿåˆ—</li>\n<li><code>this.status === PENDING</code>  åˆ¤æ–­å½“å‰ promise çš„çŠ¶æ€æ˜¯å¦ä¸º PENDINGï¼Œæ˜¯çš„è¯è¿›è¡Œæ¥ä¸‹æ¥çš„æ“ä½œï¼Œä¸æ˜¯çš„è¯ï¼Œåˆ™ä¸åšæ¥ä¸‹æ¥çš„æ“ä½œï¼ˆè¿™æ ·åšä¹Ÿæ˜¯ä¸ºäº†ä¿è¯ promise çš„çŠ¶æ€ä¸€æ—¦ç¡®å®šå°±ä¸å†æ”¹å˜ï¼‰</li>\n<li><code>this.status = REJECT</code> ,  <code>this.reason = reason</code> , å°† promise çš„çŠ¶æ€ä¿®æ”¹ä¸ºå¤±è´¥ï¼Œå¹¶å°†æˆåŠŸçš„å€¼ reason èµ‹å€¼ç»™ promise.reasonã€‚</li>\n<li><code>this.onRejectedFns.forEach((fn) =&gt; fn(this.reason))</code>  éå† <code>onRejectedFns</code> ï¼Œå°†å…¶ä¸­å­˜å‚¨çš„æˆåŠŸæ—¶çš„ <code>callback</code>  å…¨éƒ¨è°ƒç”¨ï¼Œå¹¶å°† <code>this.reason</code>  ä½œä¸ºå‚æ•°èµ‹å€¼</li>\n</ul>\n</li>\n</ol>\n</li>\n<li>\n<p>ä»¥ try-catch çš„å½¢å¼è°ƒç”¨ä¼ é€’æ¥çš„ executor å‡½æ•°ï¼Œå¹¶æ•è·é”™è¯¯</p>\n<ol>\n<li>åœ¨ try é‡Œé¢è°ƒç”¨ <code>executor</code> ï¼Œå¹¶å°† <code>resolve</code>  å’Œ <code>reject</code>  ä½œä¸ºå‚æ•°ä¼ é€’</li>\n<li>åœ¨ catch é‡Œé¢æ•è·é”™è¯¯ï¼Œä¸€ç‚¹æ•è·åˆ°é”™è¯¯ï¼Œç«‹åˆ»è°ƒç”¨ <code>reject</code>  (è¿™æ ·åšæ˜¯å› ä¸º executor æ‰§è¡Œå™¨å‡½æ•°åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸€æ—¦å‘ç”Ÿé”™è¯¯ï¼Œpromise çš„çŠ¶æ€å°†é©¬ä¸Šå˜æˆå¤±è´¥)</li>\n</ol>\n</li>\n</ul>\n<h2 id=\"then-æ–¹æ³•è®²è§£\"><a class=\"anchor\" href=\"#then-æ–¹æ³•è®²è§£\">#</a> then æ–¹æ³•è®²è§£</h2>\n<ol>\n<li>åˆ¤æ–­ onFullfilledFn, onRejectedFn ç±»å‹</li>\n</ol>\n<ul>\n<li><code>onFullfilledFn = typeof onFullfilled === 'function ? onFullfilled : (res) =&gt; res</code>  åˆ¤æ–­ <code>onFullfilledFn</code>  æ˜¯å¦ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå½“ä¸ä¸ºå‡½æ•°æ—¶ï¼Œåˆ™é»˜è®¤å°†å…¶èµ‹å€¼ä¸º (res) =&gt; res (è¿™æ ·åšæ—¶å› ä¸ºæ ¹æ® Promise A + æ ‡å‡†ï¼Œè‹¥å›è°ƒä¸ä¸ºå‡½æ•°ç±»å‹åˆ™å¿½è§†ï¼Œé»˜è®¤å€¼å›è°ƒä¼šå°†çŠ¶æ€ç»§ç»­ä¼ å…¥ä¸‹ä¸€ä¸ª promise ä¸­)ã€‚</li>\n<li><code>onRejectedFn</code>  çš„å¤„ç†åŒä¸Š</li>\n</ul>\n<ol start=\"2\">\n<li>\n<p>new ä¸€ä¸ª promise è¿”å›ï¼Œå¹¶åœ¨ executor ä¸­åšå¦‚ä¸‹æ“ä½œ</p>\n</li>\n<li>\n<p>åˆ¤æ–­è°ƒç”¨ then æ–¹æ³•çš„ promise çŠ¶æ€</p>\n</li>\n</ol>\n<ul>\n<li>\n<p>çŠ¶æ€ä¸º <code>FULLFILL</code>  æ—¶</p>\n<ol>\n<li>å°†æ¥ä¸‹æ¥çš„æ“ä½œæ”¾åˆ° try-catch ä¸­</li>\n<li>åœ¨ try ä¸­è°ƒç”¨ <code>onFullfilledFn</code>  å¹¶å°†è°ƒç”¨ <code>then</code>  æ–¹æ³•çš„ promise çš„ <code>value</code>  ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œå°†è¿”å›å€¼èµ‹å€¼ç»™ <code>result</code> ï¼Œ è°ƒç”¨ <code>resolve</code>  å¹¶å°† <code>result</code>  ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œæ¥ä¿®æ”¹è¦è¿”å›çš„ promise çš„çŠ¶æ€ã€‚</li>\n<li>åœ¨ catch ä¸­æ•è·é”™è¯¯ï¼Œä¸€æ—¦æ•è·åˆ°é”™è¯¯ï¼Œé©¬ä¸Šè°ƒç”¨ <code>reject</code>  å°†è¦è¿”å›çš„ promise ä¿®æ”¹ä¸ºå¤±è´¥ï¼ˆä¹‹æ‰€ä»¥è¿™æ ·åšæ˜¯å› ä¸º onFullfilledFn, onRejectedFn æ‰§è¡Œä¸­å‘ç”Ÿäº†é”™è¯¯ï¼Œåˆ™ä¼šç«‹å³è¿”å›ä¸€ä¸ªé”™è¯¯çš„ promiseï¼‰</li>\n</ol>\n</li>\n<li>\n<p>çŠ¶æ€ä¸º <code>REJECT</code>  æ—¶</p>\n<ol>\n<li>å°†æ¥ä¸‹æ¥çš„æ“ä½œæ”¾åˆ° try-catch ä¸­</li>\n<li>åœ¨ try ä¸­è°ƒç”¨ <code>onRejectedFn</code>  å¹¶å°†è°ƒç”¨ <code>then</code>  æ–¹æ³•çš„ promise çš„ <code>reason</code>  ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œå°†è¿”å›å€¼èµ‹å€¼ç»™ <code>result</code> ï¼Œ è°ƒç”¨ <code>resolve</code>  å¹¶å°† <code>result</code>  ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œæ¥ä¿®æ”¹è¦è¿”å›çš„ promise çš„çŠ¶æ€ã€‚</li>\n<li>åœ¨ catch ä¸­æ•è·é”™è¯¯ï¼Œä¸€æ—¦æ•è·åˆ°é”™è¯¯ï¼Œé©¬ä¸Šè°ƒç”¨ <code>reject</code>  å°†è¦è¿”å›çš„ promise ä¿®æ”¹ä¸ºå¤±è´¥ï¼ˆä¹‹æ‰€ä»¥è¿™æ ·åšæ˜¯å› ä¸º onFullfilledFn, onRejectedFn æ‰§è¡Œä¸­å‘ç”Ÿäº†é”™è¯¯ï¼Œåˆ™ä¼šç«‹å³è¿”å›ä¸€ä¸ªé”™è¯¯çš„ promiseï¼‰</li>\n</ol>\n</li>\n<li>\n<p>çŠ¶æ€ä¸º <code>PENDING</code>  æ—¶<br />\nå°† <code>FULLFILL</code> ,  <code>REJECT</code>  æ—¶è¦è¿›è¡Œçš„æ“ä½œï¼Œåˆ†åˆ«å°è£…åˆ°ä¸¤ä¸ªç®­å¤´å‡½æ•°é‡Œé¢ï¼ˆå¿…é¡»ç”¨ç®­å¤´å‡½æ•°ï¼Œè¿™æ · <code>this</code>  æ‰èƒ½æŒ‡å‘è°ƒç”¨ <code>then</code>  æ–¹æ³•çš„ promiseï¼‰ï¼Œåœ¨åˆ†åˆ«æ·»åŠ åˆ°è°ƒç”¨ <code>then</code>  æ–¹æ³•çš„ promise çš„ <code>onFullfilledFns</code>  and  <code>onRejectedFns</code>  ä¸­ã€‚</p>\n</li>\n</ul>\n",
            "tags": [
                "ç¬”è®°",
                "å‰ç«¯",
                "JavaScript",
                "å‰ç«¯",
                "JSé«˜çº§",
                "Promise"
            ]
        },
        {
            "id": "https://zimu-66ccff.github.io/eventLoop/",
            "url": "https://zimu-66ccff.github.io/eventLoop/",
            "title": "ç†è§£äº‹ä»¶å¾ªç¯",
            "date_published": "2023-02-16T02:20:17.000Z",
            "content_html": "<h1 id=\"æµè§ˆå™¨ä¸­çš„äº‹ä»¶å¾ªç¯\"><a class=\"anchor\" href=\"#æµè§ˆå™¨ä¸­çš„äº‹ä»¶å¾ªç¯\">#</a> æµè§ˆå™¨ä¸­çš„äº‹ä»¶å¾ªç¯</h1>\n<h2 id=\"åŒæ­¥ä¸å¼‚æ­¥\"><a class=\"anchor\" href=\"#åŒæ­¥ä¸å¼‚æ­¥\">#</a> åŒæ­¥ä¸å¼‚æ­¥</h2>\n<p>æµè§ˆå™¨æ˜¯<strong>å•çº¿ç¨‹</strong>çš„ï¼Œæ‰€ä»¥ä¸ºäº†ä¸å µå¡ä»£ç çš„è¿è¡Œï¼Œæˆ‘ä»¬å°†ä»»åŠ¡åˆ†ä¸ºäº†<strong>åŒæ­¥ä»»åŠ¡</strong>ï¼Œå’Œ<strong>å¼‚æ­¥ä»»åŠ¡</strong>ï¼ˆ <code>setTimeout</code>  å’Œ <code>setInterval</code> ã€ <code>axios</code> ã€äº‹ä»¶ç»‘å®šç­‰è¿™ç§å¸¦å›è°ƒå‡½æ•°çš„ï¼‰ï¼Œé‚£ä¹ˆåŒæ­¥ä»»åŠ¡å’Œå¼‚æ­¥ä»»åŠ¡åˆæ˜¯æŒ‰ç…§æ€æ ·çš„é¡ºåºè¿›å…¥ä¸»çº¿ç¨‹æ‰§è¡Œçš„å‘¢ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šå›¾å¥½å­ ğŸ˜<br />\n<img data-src=\"https://i.328888.xyz/2023/02/16/mJuAZ.png\" alt=\"äº‹ä»¶å¾ªç¯\" /></p>\n<p>å…ˆçœ‹ä¸€æ®µä»£ç ï¼Œæˆ‘ä»¬ä¼šç»“åˆè¿™å¼ å›¾å’Œä»£ç æ¥å…ˆç®€å•è®¤è¯†ä¸€ä¸‹åŒæ­¥å’Œå¼‚æ­¥çš„æ‰§è¡Œ</p>\n<p><img data-src=\"https://i.328888.xyz/2023/02/16/mKZNF.png\" alt=\"æ¼”ç¤ºä»£ç \" /><br />\næ‰§è¡Œçš„ç»“æœå¾ˆç®€å• start -&gt; end -&gt; æ—¶é—´åˆ°äº†</p>\n<ol>\n<li>æ•´ä¸ª  <code>script</code>  ä»£ç è¿›å…¥ä¸»çº¿ç¨‹ï¼Œé‡åˆ°<strong>åŒæ­¥ä»»åŠ¡</strong>  <code>start</code>  çš„æ‰“å°ï¼Œæ‰§è¡Œæ‰“å°</li>\n<li>é‡åˆ°<strong>å¼‚æ­¥ä»»åŠ¡</strong>  <code>setTimeout</code> ï¼Œå°† setTimeout æ”¾åˆ° <strong>Event Table</strong> å¼€å§‹è®¡æ—¶ï¼ˆæ³¨ï¼šsetTimeout å›è°ƒå‡½æ•°è¢«è°ƒç”¨çš„å‰ææ˜¯æ—¶é—´åˆ°äº†ï¼Œæ‰€ä»¥æ˜¯åœ¨ <strong>Event Table</strong> ä¸­ç­‰å¾…è®¡æ—¶ç»“æŸï¼Œå¦‚æœæ˜¯å…¶ä»–çš„å›è°ƒï¼Œä¾‹å¦‚ on ç»‘å®šçš„äº‹ä»¶ï¼Œåˆ™æ˜¯åœ¨ Table ä¸­ç­‰å¾…äº‹ä»¶è¢«è§¦å‘ï¼‰</li>\n<li>é‡åˆ°<strong>åŒæ­¥ä»»åŠ¡</strong>  <code>end</code>  çš„æ‰“å°ï¼Œæ‰§è¡Œæ‰“å°ï¼ŒåŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œ<strong>monitoring process</strong> è¿›ç¨‹æ£€æµ‹åˆ°ä¸»çº¿ç¨‹ä¸ºç©ºï¼Œå¼€å§‹å» <strong>Event Queue</strong> é‚£é‡Œæ£€æŸ¥æ˜¯å¦æœ‰ç­‰å¾…è¢«è°ƒç”¨çš„å‡½æ•°</li>\n<li>setTimeout çš„è®¡æ—¶ç»“æŸï¼Œå°†å…¶æ”¾åˆ° <strong>Event Queue</strong> ä¸­ï¼ˆ<strong>monitoring process</strong> è¿›ç¨‹æ£€æµ‹åˆ° <strong>Event Queue</strong> å­˜åœ¨ç­‰å¾…è¢«è°ƒç”¨çš„å‡½æ•°ï¼Œå°±å°† setTimeout çš„å›è°ƒå‡½æ•°æ”¾è¿›ä¸»çº¿ç¨‹æ‰§è¡Œï¼‰</li>\n</ol>\n<p>æ˜¯ä¸æ˜¯è§‰å¾—è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å¼€å§‹ä¸Šéš¾åº¦ï¼Œå°†å¼‚æ­¥ä»»åŠ¡ç»†åˆ†ä¸º<strong>å®ä»»åŠ¡</strong>å’Œ<strong>å¾®ä»»åŠ¡</strong>ï¼Œè¿›ä¸€æ­¥è®¤è¯†äº‹ä»¶å¾ªç¯</p>\n<h2 id=\"å®ä»»åŠ¡å¾®ä»»åŠ¡\"><a class=\"anchor\" href=\"#å®ä»»åŠ¡å¾®ä»»åŠ¡\">#</a> å®ä»»åŠ¡ï¼Œå¾®ä»»åŠ¡</h2>\n<p><strong>å¼‚æ­¥ä»»åŠ¡</strong>å¯ä»¥ç»†åˆ†ä¸º<strong>å®ä»»åŠ¡</strong>ï¼Œ<strong>å¾®ä»»åŠ¡</strong></p>\n<p>å®ä»»åŠ¡ï¼ˆ<em>task</em>ï¼‰å¤§æ¦‚åŒ…æ‹¬ï¼š</p>\n<ul>\n<li>script (æ•´ä½“ä»£ç )</li>\n<li>setTimeout</li>\n<li>setInterval</li>\n<li>setImmediate</li>\n<li>I/O</li>\n<li>UI render</li>\n</ul>\n<p>å¾®ä»»åŠ¡ï¼ˆ<em>jobs</em>ï¼‰å¤§æ¦‚åŒ…æ‹¬ï¼š</p>\n<ul>\n<li>process.nextTick</li>\n<li>Promise.then( )</li>\n<li>Async/Await (å®é™…å°±æ˜¯ promise)</li>\n<li>MutationObserver (html5 æ–°ç‰¹æ€§)</li>\n</ul>\n<h2 id=\"ç®€è¿°äº‹ä»¶å¾ªç¯\"><a class=\"anchor\" href=\"#ç®€è¿°äº‹ä»¶å¾ªç¯\">#</a> ç®€è¿°äº‹ä»¶å¾ªç¯ï¼š</h2>\n<p>æ‰§è¡Œ<strong>å®ä»»åŠ¡</strong>ï¼Œç„¶åæ‰§è¡Œè¯¥<strong>å®ä»»åŠ¡äº§ç”Ÿçš„å¾®ä»»åŠ¡</strong>ï¼Œè‹¥<strong>å¾®ä»»åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿäº†æ–°çš„å¾®ä»»åŠ¡</strong>ï¼Œåˆ™<strong>ç»§ç»­æ‰§è¡Œå¾®ä»»åŠ¡</strong>ï¼Œå¾®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œ<strong>å†å›åˆ°å®ä»»åŠ¡</strong>ä¸­è¿›è¡Œä¸‹ä¸€è½®å¾ªç¯ã€‚</p>\n<p><img data-src=\"https://i.328888.xyz/2023/02/16/mKIJw.png\" alt=\"äº‹ä»¶å¾ªç¯\" /></p>\n<p>å…‰è¿™æ ·å¤§å®¶å¯èƒ½ä¸ä¼šå¾ˆç†è§£ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸Šä¾‹å­ï¼Œç»“åˆä¾‹å­æ¥åˆ†æè®²è§£</p>\n<p><img data-src=\"https://i.328888.xyz/2023/02/16/mK7Xy.png\" alt=\"ä»£ç å®åˆ—\" /></p>\n<p>ç¬¬ä¸€è½®äº‹ä»¶å¾ªç¯åˆ†æå¦‚ä¸‹ï¼š</p>\n<ul>\n<li>æ•´ä½“ <code>script</code>  ä»£ç ä½œä¸ºç¬¬ä¸€ä¸ªå®ä»»åŠ¡è¿›å…¥ä¸»çº¿ç¨‹ï¼Œé‡åˆ°åŒæ­¥ä»»åŠ¡ <code>console.log</code> ï¼Œè¾“å‡º 1ã€‚</li>\n<li>é‡åˆ°å®ä»»åŠ¡ <code>setTimeout</code> ï¼Œå…¶å›è°ƒå‡½æ•°è¢«åˆ†å‘åˆ°<strong>å®ä»»åŠ¡ Event Queue</strong> ä¸­ï¼ˆæ³¨ï¼šsetTimeout æ˜¯å…ˆè¢«æ”¾åˆ°<strong> Event Table</strong> ä¸­è¿›è¡Œè®¡æ—¶çš„ï¼Œç­‰åˆ°æ—¶é—´åˆ°äº†ï¼Œå…¶å›è°ƒå‡½æ•°æ‰æ”¾åˆ°å®ä»»åŠ¡<strong> Event Queue</strong> ä¸­ï¼Œå¹¶ä¸æ˜¯ç›´æ¥å°±æ”¾åˆ°å®ä»»åŠ¡<strong> Event Queue</strong>ï¼‰ã€‚æˆ‘ä»¬æš‚ä¸”è®°ä¸º<em> setTimeout1</em>ã€‚</li>\n<li>é‡åˆ°å¾®ä»»åŠ¡ <code>process.nextTick()</code> ï¼Œå…¶å›è°ƒå‡½æ•°è¢«åˆ†å‘åˆ°<strong>å¾®ä»»åŠ¡ Event Queue</strong> ä¸­ã€‚æˆ‘ä»¬è®°ä¸º<em> process1</em>ã€‚</li>\n<li>é‡åˆ° Promiseï¼Œnew Promise é‡Œé¢çš„å‚æ•°å‡½æ•°ä½œä¸º<strong>åŒæ­¥ä»»åŠ¡</strong>ç›´æ¥æ‰§è¡Œï¼Œè¾“å‡º 7ã€‚then é‡Œé¢çš„å›è°ƒå‡½æ•°ä½œä¸ºå¾®ä»»åŠ¡è¢«åˆ†å‘åˆ°<strong>å¾®ä»»åŠ¡ Event Queue ä¸­</strong>ã€‚æˆ‘ä»¬è®°ä¸º<em> then1</em>ã€‚</li>\n<li>åˆé‡åˆ°äº†å®ä»»åŠ¡ <code>setTimeout</code> ï¼Œå…¶å›è°ƒå‡½æ•°è¢«åˆ†å‘åˆ°<strong>å®ä»»åŠ¡ Event Queue</strong> ä¸­ï¼Œæˆ‘ä»¬è®°ä¸º<em> setTimeout2</em>ã€‚</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å®ä»»åŠ¡ Event Queue</th>\n<th>å¾®ä»»åŠ¡ Event Queue</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>setTimeout1</td>\n<td>process1</td>\n</tr>\n<tr>\n<td>setTimeout2</td>\n<td>then1</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>ä¸Šè¡¨æ˜¯ç¬¬ä¸€è½®äº‹ä»¶å¾ªç¯å®ä»»åŠ¡ç»“æŸæ—¶å„ Event Queue çš„æƒ…å†µï¼Œæ­¤æ—¶å·²ç»è¾“å‡ºäº† 1 å’Œ 7ã€‚</li>\n</ul>\n<p><strong>ç¬¬ä¸€è½®å®ä»»åŠ¡ç»“æŸ</strong>åï¼Œå¼€å§‹å¤„ç†äº§ç”Ÿçš„<strong>å¾®ä»»åŠ¡</strong></p>\n<ul>\n<li>æ‰§è¡Œ process1, è¾“å‡º 6ã€‚</li>\n<li>æ‰§è¡Œ then1ï¼Œè¾“å‡º 8ã€‚</li>\n</ul>\n<hr />\n<p><strong>ç¬¬ä¸€è½®äº‹ä»¶å¾ªç¯æ­£å¼ç»“æŸ</strong>ï¼Œæ¥ç€å¼€å§‹<strong>ç¬¬äºŒè½®</strong>ï¼Œä»<strong>å®ä»»åŠ¡ Event Queue</strong> ä¸­å–å‡º<strong>å®ä»»åŠ¡ setTimeout1</strong> å¼€å§‹å¤„ç†ï¼š</p>\n<ul>\n<li>é¦–å…ˆæ‰§è¡ŒåŒæ­¥ä»»åŠ¡è¾“å‡º 2ã€‚æ¥ä¸‹æ¥é‡åˆ°äº†å¾®ä»»åŠ¡ <code>process.nextTick()</code> ï¼ŒåŒæ ·å°†å…¶åˆ†å‘åˆ°<strong>å¾®ä»»åŠ¡ Event Queue</strong> ä¸­ï¼Œè®°ä¸º<em> process2</em>ã€‚</li>\n<li><code>new Promise</code>  å‚æ•°é‡Œçš„å‚æ•°å‡½æ•°ä½œä¸º<strong>åŒæ­¥ä»»åŠ¡</strong>ç«‹å³æ‰§è¡Œè¾“å‡º 4ï¼Œ<strong>å¾®ä»»åŠ¡</strong> <code>then</code>  ä¹Ÿåˆ†å‘åˆ°<strong>å¾®ä»»åŠ¡ Event Queue</strong> ä¸­ï¼Œè®°ä¸º<em> then2</em></li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å®ä»»åŠ¡ Event Queue</th>\n<th>å¾®ä»»åŠ¡ Event Queue</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>setTimeout2</td>\n<td>process2</td>\n</tr>\n<tr>\n<td></td>\n<td>then2</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>ä¸Šè¡¨æ˜¯ç¬¬äºŒè½®äº‹ä»¶å¾ªç¯å®ä»»åŠ¡ç»“æŸæ—¶å„ Event Queue çš„æƒ…å†µï¼Œæ­¤æ—¶å·²ç»è¾“å‡ºäº† 2 å’Œ 4</li>\n</ul>\n<p><strong>ç¬¬äºŒè½®å®ä»»åŠ¡ç»“æŸ</strong>ï¼Œå¼€å§‹å¤„ç†äº§ç”Ÿçš„<strong>å¾®ä»»åŠ¡</strong>ï¼š</p>\n<ul>\n<li>æ‰§è¡Œ process2, è¾“å‡º 3ã€‚</li>\n<li>æ‰§è¡Œ then2ï¼Œè¾“å‡º 5ã€‚</li>\n</ul>\n<hr />\n<p><strong>ç¬¬äºŒè½®äº‹ä»¶å¾ªç¯æ­£å¼ç»“æŸ</strong>ï¼Œæ¥ç€å¼€å§‹<strong>ç¬¬ä¸‰è½®</strong>ï¼Œä»<strong>å®ä»»åŠ¡ Event Queue</strong> ä¸­å–å‡ºå®ä»»åŠ¡ <code>setTimeout2</code>  å¼€å§‹å¤„ç†ï¼š</p>\n<ul>\n<li>é¦–å…ˆæ‰§è¡ŒåŒæ­¥ä»»åŠ¡è¾“å‡º 9ã€‚æ¥ä¸‹æ¥é‡åˆ°äº†å¾®ä»»åŠ¡ <code>process.nextTick()</code> ï¼ŒåŒæ ·å°†å…¶åˆ†å‘åˆ°<strong>å¾®ä»»åŠ¡ Event Queue</strong> ä¸­ï¼Œè®°ä¸º<em> process3</em>ã€‚</li>\n<li><code>new Promise</code>  å‚æ•°é‡Œçš„å‚æ•°å‡½æ•°ä½œä¸ºåŒæ­¥ä»»åŠ¡ç«‹å³æ‰§è¡Œè¾“å‡º 11ï¼Œå¾®ä»»åŠ¡ <code>then</code>  ä¹Ÿåˆ†å‘åˆ°<strong>å¾®ä»»åŠ¡ Event Queue</strong> ä¸­ï¼Œè®°ä¸º<em> then3</em></li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>å®ä»»åŠ¡ Event Queue</th>\n<th>å¾®ä»»åŠ¡ Event Queue</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td></td>\n<td>process3</td>\n</tr>\n<tr>\n<td></td>\n<td>then3</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>ä¸Šè¡¨æ˜¯<strong>ç¬¬ä¸‰è½®äº‹ä»¶å¾ªç¯å®ä»»åŠ¡ç»“æŸ</strong>æ—¶å„ Event Queue çš„æƒ…å†µï¼Œæ­¤æ—¶å·²ç»è¾“å‡ºäº† 9 å’Œ 11ã€‚</li>\n</ul>\n<p><strong>ç¬¬ä¸‰è½®å®ä»»åŠ¡ç»“æŸ</strong>ï¼Œå¼€å§‹å¤„ç†äº§ç”Ÿçš„<strong>å¾®ä»»åŠ¡</strong>ï¼š</p>\n<ul>\n<li>æ‰§è¡Œ process3, è¾“å‡º 10ã€‚</li>\n<li>æ‰§è¡Œ then3ï¼Œè¾“å‡º 12ã€‚</li>\n</ul>\n<p>ç¬¬ä¸‰æ¬¡äº‹ä»¶å¾ªç¯ç»“æŸï¼Œæ•´ä¸ªäº‹ä»¶å¾ªç¯ç»“æŸï¼Œå…±ç»å†äº†ä¸‰æ¬¡å¾ªç¯ï¼Œå®Œæ•´çš„è¾“å‡ºä¸º 1ï¼Œ7ï¼Œ6ï¼Œ8ï¼Œ2ï¼Œ4ï¼Œ3ï¼Œ5ï¼Œ9ï¼Œ11ï¼Œ10ï¼Œ12</p>\n<h2 id=\"asyncawait-æ‰§è¡Œé¡ºåº\"><a class=\"anchor\" href=\"#asyncawait-æ‰§è¡Œé¡ºåº\">#</a> async/await æ‰§è¡Œé¡ºåº</h2>\n<p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€æ®µä»£ç ï¼š<br />\n<img data-src=\"https://i.328888.xyz/2023/02/16/mMF2Q.png\" alt=\"ä»£ç å®åˆ—\" /></p>\n<p>è¾“å‡ºç»“æœä¸ºï¼šscript start =&gt; async2 end =&gt; Promise =&gt; script end =&gt; async1 end =&gt; promise1 =&gt; promise2 =&gt; setTimeout</p>\n<p>å¦‚æœ await åé¢ç›´æ¥è·Ÿçš„ä¸ºä¸€ä¸ª<strong>å˜é‡</strong>ï¼Œæ¯”å¦‚ï¼šawait 1ï¼›è¿™ç§æƒ…å†µçš„è¯ç›¸å½“äº<strong>ç›´æ¥æŠŠ await åé¢çš„ä»£ç æ³¨å†Œä¸ºä¸€ä¸ªå¾®ä»»åŠ¡</strong>ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸º <strong>promise.then (await ä¸‹é¢çš„ä»£ç )</strong>ã€‚ç„¶åè·³å‡º async1 å‡½æ•°ï¼Œæ‰§è¡Œå…¶ä»–ä»£ç ï¼Œå½“é‡åˆ° promise å‡½æ•°çš„æ—¶å€™ï¼Œä¼šæ³¨å†Œ promise.then () å‡½æ•°åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ³¨æ„æ­¤æ—¶å¾®ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢å·²ç»å­˜åœ¨ await åé¢çš„å¾®ä»»åŠ¡ã€‚æ‰€ä»¥è¿™ç§æƒ…å†µä¼šå…ˆæ‰§è¡Œ await åé¢çš„ä»£ç ï¼ˆasync1 endï¼‰ï¼Œå†æ‰§è¡Œ async1 å‡½æ•°åé¢æ³¨å†Œçš„å¾®ä»»åŠ¡ä»£ç  (promise1,promise2)ã€‚</p>\n<p>æˆ‘ä»¬å†æ¥çœ‹å¦å¤–ä¸€æ®µä»£ç ï¼š</p>\n<p><img data-src=\"https://i.328888.xyz/2023/02/16/mMSpX.png\" alt=\"ä»£ç å®åˆ—\" /></p>\n<p>è¾“å‡ºç»“æœä¸ºï¼š script start =&gt; async2 end =&gt; Promise =&gt; script end =&gt; async2 end1 =&gt; promise1 =&gt; promise2 =&gt; async1 end =&gt; setTimeout</p>\n<p>å¦‚æœ await åé¢è·Ÿçš„ä¸º<strong>ä¸€ä¸ªå¼‚æ­¥å‡½æ•°çš„è°ƒç”¨</strong>ï¼Œæ­¤æ—¶æ‰§è¡Œå®Œ await<strong> å¹¶ä¸å…ˆæŠŠ await åé¢çš„ä»£ç æ”¾åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­å»ï¼Œè€Œæ˜¯æ‰§è¡Œå®Œ await ä¹‹åï¼Œç›´æ¥è·³å‡º async1 å‡½æ•°ï¼Œæ‰§è¡Œå…¶ä»–ä»£ç </strong>ã€‚ç„¶åé‡åˆ° promise çš„æ—¶å€™ï¼ŒæŠŠ promise.then æ³¨å†Œä¸ºå¾®ä»»åŠ¡ã€‚<strong>å…¶ä»–ä»£ç æ‰§è¡Œå®Œæ¯•åï¼Œéœ€è¦å›åˆ° async1 å‡½æ•°å»æ‰§è¡Œå‰©ä¸‹çš„ä»£ç ï¼Œç„¶åæŠŠ await åé¢çš„ä»£ç æ³¨å†Œåˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—å½“ä¸­</strong>ï¼Œæ³¨æ„æ­¤æ—¶å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­æ˜¯æœ‰ä¹‹å‰æ³¨å†Œçš„å¾®ä»»åŠ¡çš„ã€‚æ‰€ä»¥è¿™ç§æƒ…å†µä¼šå…ˆæ‰§è¡Œ async1 å‡½æ•°ä¹‹å¤–çš„å¾®ä»»åŠ¡ (promise1,promise2)ï¼Œç„¶åæ‰æ‰§è¡Œ async1 å†…æ³¨å†Œçš„å¾®ä»»åŠ¡ (async1 end). <strong>å¯ä»¥ç†è§£ä¸ºï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œawait åé¢çš„ä»£ç ä¼šåœ¨æœ¬è½®å¾ªç¯çš„æœ€åè¢«æ‰§è¡Œã€‚</strong></p>\n<p>æ€»çš„æ¥è¯´ï¼šå¦‚æœ await åé¢æ˜¯ä¸€ä¸ªå˜é‡ï¼Œåˆ™ç›´æ¥æŠŠ await åé¢çš„ä»£ç æ”¾åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢ã€‚å¦‚æœåé¢ä¸ºä¸€ä¸ªå¼‚æ­¥å‡½æ•°çš„è°ƒç”¨ï¼Œåˆ™ç­‰åˆ°æœ¬è½®å¾ªç¯ä¸­å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åå†æŠŠ await åé¢çš„ä»£ç æ”¾åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ—¶å€™ await åé¢çš„ä»£ç æ—¶æ˜¯æœ¬è½®å¾ªç¯ä¸­çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„æœ€åä¸€ä¸ªå¾®ä»»åŠ¡ï¼Œä¼šåœ¨æœ¬è½®å¾ªç¯çš„æœ€åè¢«æ‰§è¡Œã€‚</p>\n",
            "tags": [
                "ç¬”è®°",
                "å‰ç«¯",
                "JavaScript",
                "å‰ç«¯",
                "æµè§ˆå™¨",
                "JSé«˜çº§",
                "äº‹ä»¶å¾ªç¯"
            ]
        },
        {
            "id": "https://zimu-66ccff.github.io/reactivity-effect/",
            "url": "https://zimu-66ccff.github.io/reactivity-effect/",
            "title": "Vueå“åº”å¼æ¨¡å—-reactivity-effect",
            "date_published": "2023-02-14T05:57:48.000Z",
            "content_html": "<h1 id=\"effect-æ–¹æ³•å‰–æä¸å®ç°\"><a class=\"anchor\" href=\"#effect-æ–¹æ³•å‰–æä¸å®ç°\">#</a> effect æ–¹æ³•å‰–æä¸å®ç°</h1>\n<h2 id=\"å®Œæ•´ä»£ç \"><a class=\"anchor\" href=\"#å®Œæ•´ä»£ç \">#</a> å®Œæ•´ä»£ç </h2>\n<figure class=\"highlight typescript\"><figcaption data-lang=\"typescript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> <span class=\"token class-name\">EffectFn</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  deps<span class=\"token operator\">:</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span>Set<span class=\"token operator\">&lt;</span>EffectFn<span class=\"token operator\">>></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  options<span class=\"token operator\">?</span><span class=\"token operator\">:</span> Options<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Options</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  scheduler<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>fn<span class=\"token operator\">:</span> EffectFn<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  lazy<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">let</span> activeEffect<span class=\"token operator\">:</span> EffectFn<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">const</span> effectStarck<span class=\"token operator\">:</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span>EffectFn<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">const</span> targetMap<span class=\"token operator\">:</span> WeakMap<span class=\"token operator\">&lt;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  object<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  Map<span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> Set<span class=\"token operator\">&lt;</span>EffectFn<span class=\"token operator\">></span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token operator\">></span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WeakMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">effect</span><span class=\"token punctuation\">(</span><span class=\"token function-variable function\">fn</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> options<span class=\"token operator\">?</span><span class=\"token operator\">:</span> Options<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token keyword\">const</span> effectFn<span class=\"token operator\">:</span> <span class=\"token function-variable function\">EffectFn</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token function\">clearUp</span><span class=\"token punctuation\">(</span>effectFn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    activeEffect <span class=\"token operator\">=</span> effectFn<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    effectStarck<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>effectFn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    effectStarck<span class=\"token punctuation\">.</span><span class=\"token function\">pop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    activeEffect <span class=\"token operator\">=</span> effectStarck<span class=\"token punctuation\">[</span>effectStarck<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  effectFn<span class=\"token punctuation\">.</span>deps <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span>Set<span class=\"token operator\">&lt;</span>EffectFn<span class=\"token operator\">>></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  effectFn<span class=\"token punctuation\">.</span>options <span class=\"token operator\">=</span> options<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>effectFn<span class=\"token punctuation\">.</span>options<span class=\"token operator\">?.</span>lazy<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">return</span> effectFn<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token function\">effectFn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">clearUp</span><span class=\"token punctuation\">(</span>fn<span class=\"token operator\">:</span> EffectFn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  fn<span class=\"token punctuation\">.</span>deps<span class=\"token operator\">?.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>deps<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    deps<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>fn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"effect-æ¦‚è¿°\"><a class=\"anchor\" href=\"#effect-æ¦‚è¿°\">#</a> effect æ¦‚è¿°</h2>\n<p><code>effect</code>  æ˜¯ä¸€ä¸ªç”¨æ¥æ³¨å†Œå‰¯ä½œç”¨çš„å‡½æ•°ï¼Œå®ƒé»˜è®¤ä¼šå°†æ³¨å†Œçš„å‰¯ä½œç”¨ç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶æ”¯æŒä¼ é€’ä¸€ä¸ªé€‰é¡¹å‚æ•° <code>options</code> ï¼Œå¯ä»¥é…ç½®æ˜¯å¦ç«‹å³æ‰§è¡Œï¼Œå°†å‰¯ä½œç”¨å‡½æ•°è¿”å›ä»¥ä¾¿äºæ‰‹åŠ¨æ‰§è¡Œ and é…ç½®è°ƒåº¦å™¨ <code>scheduler</code></p>\n<h2 id=\"éƒ¨åˆ†å˜é‡å±æ€§æ–¹æ³•ä»‹ç»\"><a class=\"anchor\" href=\"#éƒ¨åˆ†å˜é‡å±æ€§æ–¹æ³•ä»‹ç»\">#</a> éƒ¨åˆ†å˜é‡ï¼Œå±æ€§ï¼Œæ–¹æ³•ä»‹ç»</h2>\n<ul>\n<li><strong> <code>activeEffect</code> </strong> : ç”¨æ¥å­˜å‚¨å½“å‰çš„å‰¯ä½œç”¨å‡½æ•°</li>\n<li><strong> <code>effectStrack</code> </strong> : å› ä¸º <code>effect</code>  å¯èƒ½ä¼šåµŒå¥—  <code>effect</code>  ï¼Œæ‰€ä»¥éœ€è¦ç”¨ <code>effectStrack</code>  æ¥å­˜å‚¨è¿™äº›åµŒå¥—çš„<strong>å‰¯ä½œç”¨å‡½æ•°</strong>ï¼Œå½“å†…å±‚çš„ <code>effect</code>  æ‰§è¡Œå®Œæ¯•åï¼Œå°†<strong>å†…å±‚çš„å‰¯ä½œç”¨å‡½æ•°</strong>å¼¹å‡ºï¼Œå°†<strong>å¤–å±‚çš„å‰¯ä½œç”¨å‡½æ•°</strong>èµ‹å€¼ç»™ç”¨æ¥å­˜å‚¨<strong>å½“å‰çš„å‰¯ä½œç”¨å‡½æ•°</strong>çš„ <code>activeEffect</code> ã€‚</li>\n<li><strong> <code>targetMap</code> </strong>: ä¸€ç§ <code>WeakMap</code>  ç»“æ„ï¼Œç”¨æ¥å­˜å‚¨ <code>target</code> ,  <code>key</code> , <strong>å‰¯ä½œç”¨</strong>ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚<br />\n<img data-src=\"https://i.328888.xyz/2023/02/14/mVXrd.png\" alt=\"å…³ç³»å›¾\" /></li>\n<li><strong> <code>effectFn.deps</code> </strong>: ç±»å‹ä¸º <code>Array&lt;Set&gt;</code> ï¼Œç”¨æ¥å­˜å‚¨ä¿å­˜çš„æœ‰è¯¥å‰¯ä½œç”¨çš„ <code>target</code>  å¯¹åº”çš„ <code>key</code>  å¯¹åº”çš„ <code>Set</code> , ä»¥ä¾¿äºåœ¨å‰¯ä½œç”¨å‡½æ•°<strong>å†æ¬¡æ‰§è¡Œ</strong>çš„æ—¶å€™è°ƒç”¨çš„ <code>clearUp</code>  æ–¹æ³•æ¥å°† <code>effectFn</code>  ä»è¿™äº› <code>Set</code>  ä¸­ç§»é™¤ã€‚</li>\n<li><strong> <code>clearUp</code> </strong> : åˆ©ç”¨ <code>effectFn.deps</code>  å°† <code>effectFn</code>  ä»å…¶æ‰€åœ¨çš„ <code>Set</code>  ä¸­ç§»é™¤ã€‚</li>\n</ul>\n<h2 id=\"è¯¦ç»†æ­¥éª¤\"><a class=\"anchor\" href=\"#è¯¦ç»†æ­¥éª¤\">#</a> è¯¦ç»†æ­¥éª¤</h2>\n<ul>\n<li>å®šä¹‰ <code>effectFn</code>  å¢å¼ºç‰ˆå‰¯ä½œç”¨å‡½æ•°ï¼Œä»¥ä¾¿äºå¢å¼ºå®ƒï¼Œå¹¶åšè¿›ä¸€æ­¥å¤„ç†\n<ul>\n<li><code>effectFn</code>  å‡½æ•°å°†åšçš„äº‹æƒ…\n<ol>\n<li>è°ƒç”¨ <code>clearUp</code>  æ¥å°† <code>effectFn</code>  ä»å…¶æ‰€åœ¨çš„ <code>Set</code>  ä¸­ç§»é™¤ï¼Œä»è€Œé¿å… <code>trigger</code>  è§¦å‘æ²¡å¿…è¦çš„å‰¯ä½œç”¨å‡½æ•°ã€‚</li>\n<li>å°† <code>effectFn</code>  èµ‹å€¼ç»™ <code>activeEffect</code> , å¹¶å°† <code>effectFn</code>  æ”¾è¿› <code>effectStack</code> ã€‚</li>\n<li>è°ƒç”¨ <code>fn</code>  å‰¯ä½œç”¨å‡½æ•°ï¼Œå°†è¿”å›å€¼ä¿å­˜è¿› <code>res</code> ã€‚</li>\n<li>å°† <code>effectFn</code>  ä» <code>activeEffect</code>  ä¸­å¼¹å‡ºï¼Œå¹¶å°† <code>activeEffect</code>  çš„æœ€åä¸€ä¸ªå…ƒç´ èµ‹å€¼ç»™ <code>activeEffect</code> ï¼ˆè®© <code>activeEffect</code>  æŒ‡å‘å¤–å±‚çš„å‰¯ä½œç”¨å‡½æ•°ï¼‰</li>\n<li>è¿”å› <code>res</code></li>\n</ol>\n</li>\n</ul>\n</li>\n<li>åœ¨ <code>effectFn</code>  å‡½æ•°ä¸Šæ·»åŠ å±æ€§ï¼Œå¢å¼ºå®ƒ\n<ul>\n<li>åœ¨ <code>effectFn</code>  ä¸Šæ·»åŠ  <code>deps</code>  å±æ€§ï¼Œç”¨æ¥å­˜å‚¨ä¿å­˜æœ‰è¯¥å‰¯ä½œç”¨å‡½æ•°çš„ <code>target</code>  å¯¹åº”çš„ <code>key</code>  çš„å¯¹åº”çš„ <code>Set</code> , ä»¥æä¾›ç»™ <code>clearUp</code>  å‡½æ•°ä½¿ç”¨ã€‚</li>\n<li>åœ¨ <code>effectFn</code>  å‡½æ•°ä¸Šæ·»åŠ  <code>options</code>  å±æ€§ï¼Œä¿å­˜å‰¯ä½œç”¨å‡½æ•°çš„é…ç½®é€‰é¡¹ã€‚</li>\n</ul>\n</li>\n<li>æ ¹æ® <code>effectFn</code>  å‡½æ•°çš„é…ç½®é€‰é¡¹ <code>options</code>  å±æ€§ï¼Œæ¥è¿›è¡Œä¸‹ä¸€æ­¥çš„æ“ä½œ\n<ul>\n<li>å¦‚æœ <code>effectFn.options.lazy</code>  ä¸º <code>true</code> ï¼Œåˆ™ä¸ç«‹å³æ‰§è¡Œ <code>effectFn</code> , è€Œæ˜¯å°† <code>effectFn</code>  è¿”å›ï¼Œæ‰‹åŠ¨è°ƒç”¨ã€‚</li>\n<li>å¦‚æœä¸º <code>false</code> ï¼Œ åˆ™ç«‹å³æ‰§è¡Œã€‚</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"track-æ–¹æ³•å‰–æä¸å®ç°\"><a class=\"anchor\" href=\"#track-æ–¹æ³•å‰–æä¸å®ç°\">#</a> track æ–¹æ³•å‰–æä¸å®ç°</h1>\n<h2 id=\"å®Œæ•´ä»£ç -2\"><a class=\"anchor\" href=\"#å®Œæ•´ä»£ç -2\">#</a> å®Œæ•´ä»£ç </h2>\n<figure class=\"highlight typescript\"><figcaption data-lang=\"typescript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">track</span><span class=\"token punctuation\">(</span>target<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> key<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>activeEffect<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token keyword\">let</span> depsMap <span class=\"token operator\">=</span> targetMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>depsMap<span class=\"token punctuation\">)</span> targetMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>depsMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">let</span> deps <span class=\"token operator\">=</span> depsMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>deps<span class=\"token punctuation\">)</span> depsMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>deps <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  deps<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>activeEffect<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  activeEffect<span class=\"token punctuation\">.</span>deps<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>deps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"track-æ¦‚è¿°\"><a class=\"anchor\" href=\"#track-æ¦‚è¿°\">#</a> track æ¦‚è¿°</h2>\n<p>ç”¨æ¥æ”¶é›†å‰¯ä½œç”¨ï¼Œå°†å‰¯ä½œç”¨å­˜å‚¨è¿›å¯¹åº”çš„ <code>target</code>  å¯¹åº”çš„ <code>key</code>  å¯¹åº”çš„ <code>Set</code> ã€‚</p>\n<h2 id=\"è¯¦ç»†æ­¥éª¤-2\"><a class=\"anchor\" href=\"#è¯¦ç»†æ­¥éª¤-2\">#</a> è¯¦ç»†æ­¥éª¤</h2>\n<ul>\n<li>è¾¹ç•Œå¤„ç†\n<ul>\n<li>å¦‚æœ <code>activeEffect == undefined</code> ï¼Œåˆ™ç›´æ¥è¿”å›</li>\n</ul>\n</li>\n<li>å°†å‰¯ä½œç”¨å‡½æ•°å­˜å‚¨è¿›å¯¹åº”çš„ <code>Set</code>\n<ol>\n<li>è°ƒç”¨ <code>targetMap.get(target)</code>  å–å‡º <code>target</code>  å¯¹åº”çš„ <code>Map</code> ï¼ˆé‡Œé¢å­˜å‚¨çš„æ˜¯ <code>key</code>  å’Œå¯¹åº”çš„ <code>Set</code> ï¼‰å¹¶èµ‹å€¼ç»™ <code>depsMap</code> ã€‚å¦‚æœ <code>depsMao</code>  ä¸ºç©ºï¼Œåˆ™è°ƒç”¨ <code>targetMap.set(target, (depsMap = new Map))</code>  æ–°å»ºä¸€ä¸ª <code>Map</code>  å­˜è¿› <code>targetMap</code> ã€‚</li>\n<li>è°ƒç”¨ <code>depsMap.get(key)</code>  å–å‡º <code>key</code>  å¯¹åº”çš„ <code>Set</code>  (é‡Œé¢å­˜å‚¨çš„æ˜¯ <code>key</code>  å¯¹åº”çš„å‰¯ä½œç”¨å‡½æ•°) å¹¶èµ‹å€¼ç»™ <code>deps</code> ã€‚å¦‚æœ <code>deps</code>  ä¸å­˜åœ¨ï¼Œåˆ™è°ƒç”¨ <code>depsMap.set(key, (deps = new Set()))</code>  æ–°å»ºä¸€ä¸ª <code>Set</code>  å­˜è¿› <code>depsMap</code> ã€‚</li>\n<li>è°ƒç”¨ <code>deps.add(activeEffect)</code>  å°†å‰¯ä½œç”¨å‡½æ•°å­˜å‚¨è¿› <code>Set</code> .</li>\n</ol>\n</li>\n<li>å°†å­˜æœ‰è¯¥å‰¯ä½œç”¨å‡½æ•°çš„ <code>Set</code>  å­˜å‚¨è¿› <code>activeEffect.deps</code></li>\n</ul>\n<h1 id=\"trigger-æ–¹æ³•å‰–æä¸å®ç°\"><a class=\"anchor\" href=\"#trigger-æ–¹æ³•å‰–æä¸å®ç°\">#</a> trigger æ–¹æ³•å‰–æä¸å®ç°</h1>\n<h2 id=\"å®Œæ•´ä»£ç -3\"><a class=\"anchor\" href=\"#å®Œæ•´ä»£ç -3\">#</a> å®Œæ•´ä»£ç </h2>\n<figure class=\"highlight typescript\"><figcaption data-lang=\"typescript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span>target<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> key<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token keyword\">const</span> depsMap <span class=\"token operator\">=</span> targetMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>depsMap<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">const</span> effects <span class=\"token operator\">=</span> depsMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>effects<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token keyword\">const</span> effectsToRun<span class=\"token operator\">:</span> Set<span class=\"token operator\">&lt;</span>EffectFn<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  effects<span class=\"token operator\">?.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>effectFn<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>effectFn <span class=\"token operator\">!==</span> activeEffect<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      effectsToRun<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>effectFn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  effectsToRun<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>effectFnToRun<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>effectFnToRun<span class=\"token punctuation\">.</span>options<span class=\"token operator\">?.</span>scheduler<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      effectFnToRun<span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span><span class=\"token function\">scheduler</span><span class=\"token punctuation\">(</span>effectFnToRun<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token function\">effectFnToRun</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"trigger-æ¦‚è¿°\"><a class=\"anchor\" href=\"#trigger-æ¦‚è¿°\">#</a> trigger æ¦‚è¿°</h2>\n<p>ç”¨æ¥è°ƒç”¨ <code>track</code>  æ”¶é›†çš„å‰¯ä½œç”¨ï¼Œå¦‚æœæœ‰è°ƒåº¦å™¨ï¼Œåˆ™è°ƒç”¨è°ƒåº¦å™¨ã€‚</p>\n<h3 id=\"è¯¦ç»†æ­¥éª¤-3\"><a class=\"anchor\" href=\"#è¯¦ç»†æ­¥éª¤-3\">#</a> è¯¦ç»†æ­¥éª¤</h3>\n<ul>\n<li>å–å‡ºå¯¹åº”çš„ <code>target</code>  çš„å¯¹åº”çš„ <code>key</code>  çš„å¯¹åº”çš„ <code>Set</code> , å¹¶åšè¾¹ç•Œå¤„ç†\n<ol>\n<li>è°ƒç”¨ <code>targetMap.get(target)</code>  å–å‡º <code>target</code>  å¯¹åº”çš„ <code>Map</code>  èµ‹å€¼ç»™ <code>depsMap</code> ã€‚å¦‚æœ <code>depsMap</code>  ä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›</li>\n<li>è°ƒç”¨ <code>depsMap.get(key)</code>  å–å‡º <code>key</code>  å¯¹åº”çš„ <code>Set</code>  å¹¶å¤åˆ¶ç»™ <code>effects</code> ï¼Œå¦‚æœ <code>effects</code>  ä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›ã€‚</li>\n</ol>\n</li>\n<li>å®šä¹‰ä¸€ä¸ª <code>effectsToRun</code> , å°† <code>effects</code>  å­˜å‚¨çš„å‰¯ä½œç”¨å‡½æ•°å…¨éƒ¨æ·»åŠ åˆ° <code>effectsToRun</code> , ä»¥ç­‰å¾…éå† <code>effectsToRun</code>  æ‰§è¡Œå­˜å‚¨çš„æ‰€æœ‰å‰¯ä½œç”¨å‡½æ•°ã€‚ï¼ˆä¹‹æ‰€ä»¥è¿™ä¹ˆåšæ˜¯å› ä¸ºï¼Œå‰¯ä½œç”¨å‡½æ•°åœ¨æ‰§è¡Œçš„æ—¶å€™ä¼šå…ˆè°ƒç”¨ <code>clearUp</code>  å°†å…¶ä» <code>Set</code>  ä¸­åˆ é™¤ï¼Œæ‰§è¡Œ <code>fn</code>  çš„æ—¶å€™åˆä¼šå°† <code>effectFn</code>  æ·»åŠ åˆ° <code>Set</code> , è¿™æ ·å°±ä¼šé™·å…¥æ— é™å¾ªç¯ï¼Œ æ‰€ä»¥å®šä¹‰ä¸€ä¸ªæ–°çš„ <code>Set</code>  æ¥é¿å…è¿™ä¸ªé—®é¢˜ï¼‰</li>\n<li>è°ƒç”¨ <code>effectsToRun.forEach</code>  æ¥éå†å®ƒï¼Œå¹¶è°ƒç”¨å­˜å‚¨çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œä½†æ˜¯åœ¨è°ƒç”¨å‰ä¼šåšåˆ¤æ–­ï¼Œå¦‚æœ <code>effectToRun.options.scheduler</code>  å­˜åœ¨çš„è¯ï¼Œä¼šè°ƒç”¨ <code>effectToRun.options.sheduler</code>  è€Œä¸æ˜¯è°ƒç”¨ <code>effectToRun</code></li>\n</ul>\n",
            "tags": [
                "ç¬”è®°",
                "å‰ç«¯",
                "Vue",
                "VueåŸç†å®ç°",
                "å‰ç«¯",
                "Vue",
                "VueåŸç†åˆ¨æ",
                "Vueå“åº”å¼æ¨¡å—åˆ¨æ",
                "effect"
            ]
        },
        {
            "id": "https://zimu-66ccff.github.io/reactivity-reactive/",
            "url": "https://zimu-66ccff.github.io/reactivity-reactive/",
            "title": "Vueå“åº”å¼æ¨¡å—-reactivity-reactive",
            "date_published": "2023-02-14T02:21:11.000Z",
            "content_html": "<h1 id=\"ractive-æ–¹æ³•å‰–æä¸å®ç°\"><a class=\"anchor\" href=\"#ractive-æ–¹æ³•å‰–æä¸å®ç°\">#</a> ractive æ–¹æ³•å‰–æä¸å®ç°</h1>\n<h2 id=\"å®Œæ•´ä»£ç å®ç°\"><a class=\"anchor\" href=\"#å®Œæ•´ä»£ç å®ç°\">#</a> å®Œæ•´ä»£ç å®ç°</h2>\n<figure class=\"highlight typescript\"><figcaption data-lang=\"typescript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> isArray<span class=\"token punctuation\">,</span> isObject<span class=\"token punctuation\">,</span> hasChanged <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../utils/index'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> effect<span class=\"token punctuation\">,</span> track<span class=\"token punctuation\">,</span> trigger <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./effect'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">reactive</span><span class=\"token punctuation\">(</span>target<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">isObject</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> target<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isReactive</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> target<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>reactiveMap<span class=\"token punctuation\">.</span><span class=\"token function\">has</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> reactiveMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token keyword\">const</span> reactiveProxy<span class=\"token operator\">:</span> Record<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">symbol</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">any</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Proxy</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    target<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token function\">get</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key <span class=\"token operator\">===</span> <span class=\"token string\">'_isReactive'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token function\">track</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> Reflect<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">isObject</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">reactive</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> res<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token function\">set</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">,</span> newValue<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">const</span> oldValue <span class=\"token operator\">=</span> Reflect<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">const</span> oldLength <span class=\"token operator\">=</span> Reflect<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> <span class=\"token string\">'length'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> Reflect<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">,</span> newValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">hasChanged</span><span class=\"token punctuation\">(</span>oldValue<span class=\"token punctuation\">,</span> newValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>          <span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            oldLength <span class=\"token operator\">!=</span> Reflect<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> <span class=\"token string\">'length'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            key <span class=\"token operator\">!==</span> <span class=\"token string\">'length'</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>          <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> <span class=\"token string\">'length'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  reactiveMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> reactiveProxy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token keyword\">return</span> reactiveProxy<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">isReactive</span><span class=\"token punctuation\">(</span>target<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>  <span class=\"token keyword\">return</span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>target <span class=\"token operator\">&amp;&amp;</span> target<span class=\"token punctuation\">.</span>__isReactive<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"è¾¹ç•Œå¤„ç†å¯¹ç‰¹æ®Šæƒ…å†µçš„å¤„ç†\"><a class=\"anchor\" href=\"#è¾¹ç•Œå¤„ç†å¯¹ç‰¹æ®Šæƒ…å†µçš„å¤„ç†\">#</a> è¾¹ç•Œå¤„ç†ï¼ˆå¯¹<strong>ç‰¹æ®Šæƒ…å†µ</strong>çš„å¤„ç†ï¼‰</h2>\n<ul>\n<li><code>target</code>  çš„ç±»å‹ä¸ä¸º  <code>Object</code>  æ—¶ï¼š\n<ul>\n<li>åˆ©ç”¨ <code>isObject</code>  æ–¹æ³•åˆ¤æ–­ <code>target</code>  çš„ç±»å‹æ˜¯å¦ä¸º <code>Object</code></li>\n<li><code>isObject</code>  æ–¹æ³•çš„è¿”å›å€¼ä¸º <code>false</code>  æ—¶ï¼Œå³ <code>target</code>  çš„ç±»å‹ä¸ä¸º <code>Object</code> , åˆ™ç›´æ¥è¿”å› <code>target</code> , ä¸åšæ¥ä¸‹æ¥çš„å“åº”å¼å¤„ç†</li>\n</ul>\n</li>\n<li><code>target</code> <strong> æœ¬èº«</strong>å·²ç»ä¸ºä¸€ä¸ª<strong>å“åº”å¼ä»£ç†</strong>æ—¶:\n<ul>\n<li>åˆ©ç”¨ <code>isRective</code>  æ–¹æ³•åˆ¤æ–­ <code>target</code>  æ˜¯å¦ä¸º<strong>å“åº”å¼ä»£ç†</strong></li>\n<li><code>isReactive</code>  æ–¹æ³•çš„è¿”å›å€¼ä¸º <code>true</code>  æ—¶ï¼Œ å³ <code>target</code>  å·²ç»ä¸ºä¸€ä¸ª<strong>å“åº”å¼ä»£ç†</strong>ï¼Œåˆ™ç›´æ¥è¿”å› <code>target</code> ï¼Œä¸å†åšæ¥ä¸‹æ¥çš„å¤„ç†</li>\n</ul>\n</li>\n<li><code>target</code>  å·²ç»<strong>è¢«åšè¿‡å“åº”å¼ä»£ç†</strong>æ—¶:\n<ul>\n<li>åˆ©ç”¨ <code>reactiveMap.has(target)</code>  æ–¹æ³•æ¥åˆ¤æ–­ <code>target</code>  æ˜¯å¦å·²ç»è¢«åšè¿‡<strong>å“åº”å¼ä»£ç†</strong></li>\n<li><code>reactiveMap.has(target)</code>  æ–¹æ³•è¿”å›å€¼ä¸º <code>true</code>  æ—¶ï¼Œ å³ <code>target</code>  å·²ç»è¢«åšè¿‡<strong>å“åº”å¼ä»£ç†</strong>ï¼Œåˆ™ç›´æ¥è°ƒç”¨ <code>reactiveMap.get(targey)</code>  æ–¹æ³•è¿”å›<strong>å®ƒçš„å“åº”å€¼ä»£ç†</strong></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"å“åº”å¼å¤„ç†\"><a class=\"anchor\" href=\"#å“åº”å¼å¤„ç†\">#</a> å“åº”å¼å¤„ç†</h2>\n<h3 id=\"æ•´ä½“æ¦‚è¿°\"><a class=\"anchor\" href=\"#æ•´ä½“æ¦‚è¿°\">#</a> æ•´ä½“æ¦‚è¿°</h3>\n<p>åˆ©ç”¨ <code>Proxy</code>  å¯¹ <code>target</code>  åšä¸€ä¸ª<strong>æ•°æ®ä»£ç†</strong>ï¼Œæ‹¦æˆªå…¶ <code>getter</code>  and  <code>setter</code> , æœ€åè¿”å›è¿™ä¸ª<strong>æ•°æ®ä»£ç†</strong></p>\n<h3 id=\"è¯¦ç»†æ­¥éª¤\"><a class=\"anchor\" href=\"#è¯¦ç»†æ­¥éª¤\">#</a> è¯¦ç»†æ­¥éª¤</h3>\n<ul>\n<li>\n<p><strong>æ‹¦æˆª getter</strong></p>\n<ol>\n<li><em>åšè¾¹ç•Œå¤„ç†</em>\n<ul>\n<li><code>if(key === '_isReactive')</code>  åˆ¤æ–­å…¶è¦è·å–çš„ <code>key</code>  æ˜¯å¦ä¸º <code>_isReactive</code> , å½“ <code>if</code>  åˆ¤æ–­ä¸º <code>true</code>  æ—¶ï¼Œåˆ™ç›´æ¥è¿”å› <code>false</code> ï¼Œ<strong>ä¸å†è¿›è¡Œæ¥ä¸‹æ¥çš„å¤„ç†</strong></li>\n</ul>\n</li>\n<li><em>æ”¶é›†å‰¯ä½œç”¨</em>\n<ul>\n<li>è°ƒç”¨ <code>track</code>  æ–¹æ³•æ¥æ”¶é›†<strong>å‰¯ä½œç”¨å‡½æ•°</strong>ï¼Œå°†å…¶æ”¶é›†åˆ° <code>target</code>  å¯¹åº”çš„ <code>key</code>  çš„å¯¹åº”çš„ <code>Set</code>  é‡Œé¢ï¼Œç­‰å¾… <code>setter</code>  è¢«è§¦å‘ï¼Œå¹¶ä¿®æ”¹ <code>target[key]</code>  çš„æ—¶å€™è°ƒç”¨ <code>trigger</code>  æ¥å°†è¿™ä¸ª <code>Set</code>  é‡Œé¢å­˜å‚¨çš„<strong>å‰¯ä½œç”¨å‡½æ•°</strong>ä¸€ä¸€è§¦å‘.</li>\n<li><strong>ps</strong>: <em><a href=\"https://zimu-66ccff.github.io/reactivity-effect/\">(track æ–¹æ³•çš„è®²è§£è¯·ç‚¹å‡»è¿™é‡Œå¥¥)</a></em></li>\n</ul>\n</li>\n<li><em>è¿”å› <code>target[key]</code>  çš„å€¼ï¼Œåšæ·±åº¦å“åº”å¼å¤„ç†</em>\n<ul>\n<li>åˆ©ç”¨ <code>Reflect.get(target, key)</code>  å–å‡º <code>target[key]</code>  çš„å€¼</li>\n<li>åˆ¤æ–­ <code>target[key]</code>  çš„å€¼çš„ç±»å‹æ˜¯å¦ä¸º <code>Object</code> , å½“ä¸º <code>Object</code>  æ—¶ï¼Œåˆ™è¿”å› <code>reactive(target[key])</code>  å¯¹å…¶åšæ·±åº¦å“åº”å¼å¤„ç†ï¼Œå½“ä¸ä¸º <code>Object</code>  æ—¶ï¼Œåˆ™ç›´æ¥è¿”å› <code>target[key]</code></li>\n</ul>\n</li>\n</ol>\n</li>\n<li>\n<p><strong>æ‹¦æˆª setter</strong></p>\n<ol>\n<li><em>å–å‡ºç›¸å…³æ•°æ®ï¼Œ è¿›è¡Œæ›´æ–°æ“ä½œ</em>\n<ul>\n<li>åˆ©ç”¨ <code>Reflect.get</code>  æ–¹æ³•å–å‡ºæ²¡æœ‰ä¿®æ”¹å‰çš„ <code>target[key]</code>  å³ <code>oldValue</code>  and æ²¡æœ‰ä¿®æ”¹å‰çš„ <code>target[length]</code>  å³ <code>oldLength</code> , åˆ©ç”¨ <code>Reflect.set</code>  è¿›è¡Œå¯¹ <code>target[key]</code>  çš„æ›´æ–°</li>\n</ul>\n</li>\n<li><em>åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒç”¨å¯¹åº”çš„ <code>key</code>  å¯¹åº”çš„ <code>Set</code>  å­˜å‚¨çš„å‰¯ä½œç”¨å‡½æ•°</em>\n<ul>\n<li>åˆ©ç”¨ <code>hasChanged()</code>  åˆ¤æ–­æ–°æ—§å€¼æ˜¯å¦å‘ç”Ÿäº†æ”¹å˜ï¼Œå¦‚æœæ²¡æœ‰æ”¹å˜åˆ™ä¸è¿›è¡Œæ¥ä¸‹æ¥çš„å¤„ç†ã€‚å¦‚æœå‘ç”Ÿäº†æ”¹å˜ï¼Œåˆ™è°ƒç”¨ <code>trigger</code>  æ–¹æ³•ï¼Œæ¥è°ƒç”¨å¯¹åº”çš„ <code>key</code>  å¯¹åº”çš„ <code>Set</code>  å­˜å‚¨çš„å‰¯ä½œç”¨å‡½æ•°</li>\n<li><strong>ps</strong>: <em><a href=\"https://zimu-66ccff.github.io/reactivity-effect/\">trigger æ–¹æ³•çš„è®²è§£è¯·ç‚¹å‡»è¿™é‡Œå¥¥</a></em></li>\n</ul>\n</li>\n<li><em>åˆ¤æ–­ <code>target</code>  æ˜¯å¦ä¸º <code>Array</code> , å¹¶ä¸”æ•°ç»„çš„é•¿åº¦æ˜¯å¦å‘ç”Ÿäº†æ”¹å˜</em>\n<ul>\n<li>åˆ©ç”¨ <code>isArray</code>  åˆ¤æ–­ <code>target</code> ï¼Œå¹¶åˆ©ç”¨ <code>Reflect.get()</code>  å–å¾—æ›´æ–°åæ•°ç»„çš„é•¿åº¦ï¼Œå¹¶ä¸ä¹‹å‰æ•°ç»„çš„é•¿åº¦ <code>oldLength</code>  æ¯”è¾ƒï¼Œçœ‹æ˜¯å¦å‘ç”Ÿäº†æ”¹å˜ï¼Œå¦‚æœå‘ç”Ÿäº†æ”¹å˜ï¼Œåˆ™è°ƒç”¨ <code>tigger</code>  æ–¹æ³•ï¼Œæ¥è°ƒç”¨ <code>length</code>  å¯¹åº”çš„ <code>Set</code>  å­˜å‚¨çš„å‰¯ä½œç”¨ã€‚<em>ï¼ˆä¹‹æ‰€ä»¥è¦è¿™æ ·åšï¼Œæ˜¯å› ä¸ºå½“ç»™æ•°ç»„å¢åŠ  or åˆ é™¤å…ƒç´ çš„æ—¶å€™ï¼Œæ•°ç»„çš„ <code>length</code>  å°±å·²ç»æ”¹å˜äº†ï¼Œ å½“å¯¹ <code>length</code>  çš„æ›´æ–°çš„æ‹¦æˆªçš„æ—¶å€™ï¼Œå°±ä¼šå‘ç°æ–°å€¼å’Œæ—§å€¼æ˜¯ä¸€æ ·çš„ï¼Œå°±ä¸ä¼šè§¦å‘ <code>trigger</code> ï¼‰</em></li>\n</ul>\n</li>\n</ol>\n</li>\n<li>\n<p><strong>å°†å“åº”å¼ä»£ç†å­˜å‚¨èµ·æ¥ï¼Œå¹¶è¿”å›å“åº”å¼ä»£ç†</strong></p>\n<ol>\n<li>è°ƒç”¨ <code>reactiveMap.set</code>  æ–¹æ³•ï¼Œå°†å“åº”å¼ä»£ç†å’Œ <code>target</code>  å…³è”èµ·æ¥å¹¶å­˜å‚¨ï¼Œä»¥ä¾¿äºåšä¸Šæ–‡çš„<strong>è¾¹ç•Œå¤„ç†</strong> ( <code>target</code>  å·²ç»è¢«åšè¿‡å“åº”å¼ä»£ç†æ—¶)</li>\n<li><strong>è¿”å›å“åº”å¼ä»£ç†</strong></li>\n</ol>\n</li>\n</ul>\n",
            "tags": [
                "ç¬”è®°",
                "å‰ç«¯",
                "Vue",
                "VueåŸç†å®ç°",
                "å‰ç«¯",
                "Vue",
                "VueåŸç†åˆ¨æ",
                "Vueå“åº”å¼æ¨¡å—åˆ¨æ",
                "reactive"
            ]
        },
        {
            "id": "https://zimu-66ccff.github.io/promiseLearn/",
            "url": "https://zimu-66ccff.github.io/promiseLearn/",
            "title": "ç†è§£ä¸ºä»€ä¹ˆéœ€è¦Promise",
            "date_published": "2023-02-12T10:23:50.000Z",
            "content_html": "<h1 id=\"ä¸ºä»€ä¹ˆéœ€è¦-promise\"><a class=\"anchor\" href=\"#ä¸ºä»€ä¹ˆéœ€è¦-promise\">#</a> ä¸ºä»€ä¹ˆéœ€è¦ Promiseï¼ŸğŸ¤”</h1>\n<h2 id=\"æ˜ç™½åŒæ­¥ä»»åŠ¡-and-å¼‚æ­¥ä»»åŠ¡\"><a class=\"anchor\" href=\"#æ˜ç™½åŒæ­¥ä»»åŠ¡-and-å¼‚æ­¥ä»»åŠ¡\">#</a> æ˜ç™½åŒæ­¥ä»»åŠ¡ and å¼‚æ­¥ä»»åŠ¡</h2>\n<p>é¦–å…ˆï¼Œå‰ç«¯ er ä»¬éœ€è¦æ˜ç¡®ä¸€ç‚¹ï¼Œåœ¨ js è¿™ç§å•çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯æ¨¡å‹ä¸­ï¼Œä¸€ä»¶äº‹æƒ…æ²¡åšå®Œæ˜¯ä¸èƒ½åšä¸‹ä¸€ä»¶äº‹æƒ…çš„ã€‚è¿™æ—¶å€™ç¿æ™ºçš„å‹å‹ä»¬å°±ä¼šè¯´è¿™åˆå’‹äº†å‘¢ï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿå“å˜¿ï¼Œè¿˜çœŸæœ‰é—®é¢˜ï¼Œé—®é¢˜è¿˜å¤§äº†ï¼Œè¦æ˜¯ä¸­é—´æœ‰ä¸€ä»¶äº‹æƒ…è€—æ—¶å¤ªé•¿ï¼Œå¯¼è‡´åé¢è€—æ—¶å¾ˆçŸ­çš„äº‹æƒ…åšä¸äº†æ€ä¹ˆåŠå‘¢ï¼Ÿä½ çœ‹ï¼Œè¿™ä¸å°±å µè½¦äº†ï¼Œè¿˜ä¼šå µå¾ˆä¹…ã€‚ä½†æ˜¯æˆ‘ä»¬èªæ˜çš„å‰ç«¯ er ä»¬é©¬ä¸Šå°±æœ‰äº†è§£å†³æ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆä¸ç®¡é‚£ä¸ªè€—æ—¶å¾ˆé•¿çš„äº‹æƒ…ï¼Œå…ˆåšåé¢çš„äº‹æƒ…ï¼Œæœ€åå†ç®¡è¿™ä¸ªè€—æ—¶å¾ˆé•¿çš„äº‹æƒ…ä¸å°±å®Œäº‹äº†å— ğŸ˜ã€‚<br />\nå¯¹çš„ï¼Œå°±æ˜¯è¿™ç§è§£å†³æ–¹æ¡ˆï¼Œæ•²é»‘æ¿ ğŸ˜¸ï¼Œjs ä¸­ä»£ç åˆ†ä¸ºåŒæ­¥ä»»åŠ¡å’Œå¼‚æ­¥ä»»åŠ¡ï¼Œå¼‚æ­¥ä»»åŠ¡é€šå¸¸ä¸ºé‚£ç§å¯èƒ½ä¼šè€—æ—¶å¾ˆé•¿ or éœ€è¦è§¦å‘æ¡ä»¶çš„ï¼Œä¹Ÿå°±æ˜¯å‰é¢è¯´çš„å¯èƒ½ä¼šå µè½¦ï¼Œè¿˜å µå¾ˆä¹…çš„é‚£ç§ã€‚åŒæ­¥ä»»åŠ¡å½“ç„¶å°±æ˜¯é™¤äº†å¼‚æ­¥ä»»åŠ¡ä»¥å¤–çš„ä»»åŠ¡å•¦ã€‚åœ¨ js çš„æ‰§è¡Œæœºåˆ¶ä¸­ï¼Œä¼šå…ˆæ‰§è¡ŒåŒæ­¥ä»»åŠ¡ï¼Œç­‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ã€‚</p>\n<h2 id=\"æ—©æœŸå¼‚æ­¥æ“ä½œçš„ç§ç§é—®é¢˜\"><a class=\"anchor\" href=\"#æ—©æœŸå¼‚æ­¥æ“ä½œçš„ç§ç§é—®é¢˜\">#</a> æ—©æœŸå¼‚æ­¥æ“ä½œçš„ç§ç§é—®é¢˜</h2>\n<p>æ—©æœŸ js ä¸­åªæ”¯æŒå®šä¹‰å›è°ƒå‡½æ•°æ¥è¡¨æ˜å¼‚æ­¥æ“ä½œçš„å®Œæˆï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¼šä»¥ setTimeout è¿™ä¸ªå¼‚æ­¥æ“ä½œä¸ºä¾‹å­è¿›è¡Œè®²è§£ã€‚<br />\nè¯•æƒ³è¿™æ ·çš„ä¸€ç§åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ setTimeout ä¸­ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œåœ¨å‡ ç§’åæ‰§è¡Œï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œå®ƒæœ‰æ˜æ˜¾çš„è§¦å‘æ¡ä»¶ï¼Œæ—¶é—´ã€‚è¿™ä¸ªå›è°ƒå‡½æ•°ä¸­æˆ‘ä»¬ä¼šè¿›è¡Œæ—¶é—´åˆ°äº†åæˆ‘ä»¬å¸Œæœ›è¿›è¡Œçš„æ“ä½œï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è¿™ä¸ªå›è°ƒå‡½æ•°å¸Œæœ›å¯¹å¤–è¿”å›ä¸€ä¸ªæ•°æ®ï¼Œä»¥ä¾¿äºè¿›ä¸€æ­¥çš„å¤„ç†æ€ä¹ˆåŠï¼ŸğŸ¤” è¿™æ—¶å€™ä½ å°±ä¼šå‘ç°é—®é¢˜ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥è¿”å›æ•°æ®ã€‚å¥½çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚å…¶å®è¿˜æœ‰æ›´ä¸¥é‡çš„é—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬è¿›ä¸€æ­¥çš„æ“ä½œä¹Ÿæ˜¯å¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚ä¹Ÿæ˜¯åœ¨å‡ ç§’åæ‰§è¡Œæ€ä¹ˆåŠï¼Œä½ ä¼šæƒ³åˆ°ï¼Œå†ä½¿ç”¨ä¸€æ¬¡ setTimeoutï¼Œå†ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚é‚£ä¹ˆç°åœ¨å›è°ƒå‡½æ•°é‡Œé¢åˆåµŒå¥—äº†ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå¦‚æœè¿˜è¦è¿›ä¸€æ­¥æ“ä½œå‘¢ï¼Œè¿˜æ˜¯å¼‚æ­¥æ“ä½œå‘¢ï¼Œå†åµŒå¥—ï¼ŒåµŒå¥—ï¼ŒåµŒå¥—ï¼ŒåµŒå¥—ï¼Œæœ€åä½ ä¸€ä¸ªå›è°ƒå‡½æ•°é‡Œé¢åµŒå¥—äº† n ä¸ªå‡½æ•°ï¼Œæœ€åçš„åœºæ™¯æ˜¯ä»€ä¹ˆæ ·å­å‘¢ã€‚å›è°ƒåœ°ç‹±ï¼ï¼ï¼è¯·çœ‹ä¸‹å›¾ã€‚<br />\n<img data-src=\"https://i.328888.xyz/2023/02/12/cwAbF.png\" alt=\"å›è°ƒåœ°ç‹±\" /></p>\n<p>ç›¸ä¿¡å‰ç«¯ er çœ‹åˆ°ç±»ä¼¼è¿™ç§ä»£ç ï¼Œè¡€å‹æ˜¯é©¬ä¸Šå°±ä¼šä¸Šå‡çš„ï¼Œæ‰€ä»¥å¯ä¸è¦å†™è¿™ç§ä»£ç å¥¥ã€‚</p>\n<p>å®é™…ä¸Šå¼‚æ­¥æ“ä½œçš„é—®é¢˜å¯ä¸æ­¢è¿™äº›ï¼Œæ¯”å¦‚å¦‚æœå¼‚æ­¥æ“ä½œå¤±è´¥äº†ï¼Œæ€ä¹ˆè¿›è¡Œåç»­çš„å¤„ç†ï¼Œæ€ä¹ˆæ‹¿åˆ°å¤±è´¥çš„åŸå› ï¼Œè¿™éƒ½æ˜¯éœ€è¦è§£å†³çš„ã€‚<br />\né‚£ä¹ˆä¸ºäº†è§£å†³ï¼Œå¦‚ä½•æ‹¿åˆ°è¿”å›å€¼ï¼› å¼‚æ­¥æ“ä½œå¤±è´¥åå¦‚ä½•æ‹¿åˆ°å¤±è´¥çš„åŸå› ï¼Œå¹¶è¿›ä¸€æ­¥å¤„ç†ï¼›å¦‚ä½•é¿å…å›è°ƒåœ°ç‹±ï¼›Promise åº”è¿è€Œç”Ÿ ğŸ˜</p>\n<h1 id=\"promise-æ˜¯ä»€ä¹ˆ\"><a class=\"anchor\" href=\"#promise-æ˜¯ä»€ä¹ˆ\">#</a> Promise æ˜¯ä»€ä¹ˆï¼ŸğŸ¤”</h1>\n<p>Promise æ˜¯ä¸€ç§å¼‚æ­¥ç¼–ç¨‹æœºåˆ¶ï¼Œæ˜¯å¯¹å›è°ƒåœ°ç‹±çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚<br />\nPromise å®åˆ—åˆ™æ˜¯ä¸€ç§çŠ¶æ€æœºï¼Œå®ƒæœ‰ä¸‰ç§åŸºæœ¬çŠ¶æ€ï¼Œå¾…å®šï¼ˆpendingï¼‰ï¼Œå…‘ç°ï¼ˆfulfilled)ï¼Œ æ‹’ç» (rejected)ï¼Œæœ€åˆçš„çŠ¶æ€ä¸º pendingï¼ŒçŠ¶æ€ä¸€æ—¦æ”¹å˜ï¼Œå°±å®šäº†ï¼Œå°±ä¸ä¼šå†å‘ç”Ÿä»»ä½•æ”¹å˜äº†ã€‚</p>\n<h1 id=\"promise-æ˜¯æ€ä¹ˆè§£å†³æ—©æœŸå¼‚æ­¥æ“ä½œçš„ç–‘éš¾æ‚ç—‡çš„\"><a class=\"anchor\" href=\"#promise-æ˜¯æ€ä¹ˆè§£å†³æ—©æœŸå¼‚æ­¥æ“ä½œçš„ç–‘éš¾æ‚ç—‡çš„\">#</a> Promise æ˜¯æ€ä¹ˆè§£å†³æ—©æœŸå¼‚æ­¥æ“ä½œçš„ç–‘éš¾æ‚ç—‡çš„ ğŸ¤”</h1>\n<h2 id=\"è§£å†³å¦‚ä½•æ‹¿åˆ°è¿”å›å€¼å½“å¼‚æ­¥æ“ä½œå¤±è´¥åå¦‚ä½•æ‹¿åˆ°å¤±è´¥çš„åŸå› å¹¶è¿›ä¸€æ­¥å¤„ç†çš„é—®é¢˜\"><a class=\"anchor\" href=\"#è§£å†³å¦‚ä½•æ‹¿åˆ°è¿”å›å€¼å½“å¼‚æ­¥æ“ä½œå¤±è´¥åå¦‚ä½•æ‹¿åˆ°å¤±è´¥çš„åŸå› å¹¶è¿›ä¸€æ­¥å¤„ç†çš„é—®é¢˜\">#</a> è§£å†³å¦‚ä½•æ‹¿åˆ°è¿”å›å€¼ï¼›å½“å¼‚æ­¥æ“ä½œå¤±è´¥åå¦‚ä½•æ‹¿åˆ°å¤±è´¥çš„åŸå› ï¼Œå¹¶è¿›ä¸€æ­¥å¤„ç†çš„é—®é¢˜</h2>\n<p>æ„é€ å‡½æ•° Promiseï¼ˆï¼‰ä¸­å¯ä»¥ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°è¿™ä¸ªå›è°ƒå‡½æ•°ä¸ºæ‰§è¡Œå™¨å‡½æ•°ï¼Œæ‰§è¡Œå™¨å‡½æ•°ä¸»è¦æœ‰ä¸¤é¡¹èŒè´£ï¼š1. åˆå§‹åŒ–æœŸçº¦çš„å¼‚æ­¥è¡Œä¸ºï¼ˆåœ¨æ‰§è¡Œå™¨å‡½æ•°ä¸­è¿›è¡Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„å¼‚æ­¥æ“ä½œï¼‰å’Œæ§åˆ¶çŠ¶æ€çš„æœ€ç»ˆè½¬æ¢ï¼ˆå°† Promise å®åˆ—çš„çŠ¶æ€ç”±æœ€åˆçš„ pending è½¬æ¢ä¸º fulfilled or rejectedï¼‰ã€‚é‚£ä¹ˆå®ƒæ˜¯æ€ä¹ˆæ¥æ§åˆ¶çŠ¶æ€çš„æœ€ç»ˆè½¬æ¢çš„å‘¢ï¼ŸğŸ¤” å¾ˆç®€å•ï¼Œè¿™ä¸ªæ‰§è¡Œå™¨å‡½æ•°æ˜¯è‡ªå¸¦ä¸¤ä¸ªå‚æ•°çš„ï¼Œè¿™ä¸¤ä¸ªå‚æ•°éƒ½ä¸ºå‡½æ•°ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°ä¸º resolveï¼Œ rejectã€‚ä½ å¯ä»¥åœ¨ resolve ä¸­ä¼ é€’å‚æ•°ï¼Œæ¥è¿”å›ä½ éœ€è¦çš„æ•°æ®ï¼›å¯ä»¥åœ¨ reject ä¸­ä¼ é€’å‚æ•°ï¼Œæ¥è¿”å›å¼‚æ­¥æ“ä½œå¤±è´¥çš„åŸå› ã€‚å½“ä½ åœ¨æ‰§è¡Œå™¨å‡½æ•°ä¸­è°ƒç”¨ resolveï¼ŒPromise å®åˆ—çš„çŠ¶æ€å°±ç”± pending å˜ä¸ºäº† fulfilledï¼ˆæ³¨ï¼šè¿™é‡Œä¸æ˜¯ååˆ†å‡†ç¡®ï¼Œéœ€è¦æ ¼å¤–æ³¨æ„ä¸€ç§ç‰¹åˆ«æƒ…å†µï¼Œå¦‚æœè¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ª Promiseï¼Œé‚£ä¹ˆ Promise å®åˆ—çš„çŠ¶æ€å°†ç”±è¿”å›çš„è¿™ä¸ª Promise å†³å®šï¼Œä¸ºè¿™ä¸ª Promise çš„çŠ¶æ€ï¼Œä¸ä¸€å®šä¸º fulfilledï¼‰ï¼›åŒç†ï¼Œå½“ä½ è°ƒç”¨äº† rejectï¼ŒPromise å®åˆ—çš„çŠ¶æ€å°±ç”± pending å˜ä¸ºäº† rejectedã€‚<br />\né€šè¿‡æ‰§è¡Œå™¨å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°å‡½æ•°ï¼Œresolveï¼Œreject æˆ‘ä»¬æˆåŠŸçš„è§£å†³äº†å¦‚ä½•æ‹¿åˆ°è¿”å›å€¼ï¼Œå¼‚æ­¥æ“ä½œç»“æŸåæ‹¿åˆ°å¤±è´¥çš„åŸå› çš„é—®é¢˜ã€‚<br />\né‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥ï¼Œè§£å†³æ€ä¹ˆè¿›ä¸€æ­¥å¤„ç†çš„é—®é¢˜ã€‚è¿™é‡Œæˆ‘ä»¬å°±éœ€è¦çŸ¥é“ Promise å®åˆ—ä¸Šé¢å…¶å®æ˜¯ç”±ä¸€ä¸ª then æ–¹æ³•çš„ï¼Œä¸è¿‡å…¶å®è¿™ä¸ªæ–¹æ³•æ˜¯å®šä¹‰åœ¨ Promise å®åˆ—çš„æ„é€ å‡½æ•°çš„åŸå‹ä¸Šé¢çš„ã€‚è¿™ä¸ª then æ–¹æ³•ä¸€æ ·æœ‰ä¸¤ä¸ªå‚æ•°å‡½æ•°ï¼Œä¸€èˆ¬ç§°ä¸º onResolved, onRejectedã€‚å½“ promise å®åˆ—çš„çŠ¶æ€ä¸º fulfilled çš„æ—¶å€™ï¼Œå°±ä¼šæ‰§è¡Œç¬¬ä¸€ä¸ªå‚æ•°å‡½æ•°ï¼Œå³ onResolvedï¼›å½“ promise å®åˆ—çš„çŠ¶æ€ä¸º rejected çš„æ—¶å€™ï¼Œå°±ä¼šæ‰§è¡Œç¬¬äºŒä¸ªå‚æ•°å‡½æ•°ï¼Œå³ onRejectedã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸¤ä¸ªå‚æ•°å‡½æ•°ä¸­å†™å…¥å¯¹åº”çš„è¿›ä¸€æ­¥å¤„ç†çš„é€»è¾‘ã€‚<br />\nè‡³æ­¤ï¼Œæˆ‘ä»¬å°±è§£å†³äº†å¦‚ä½•æ‹¿åˆ°è¿”å›å€¼ï¼Œæ‹¿åˆ°å¼‚æ­¥æ“ä½œå¤±è´¥çš„æ—¶å€™å¤±è´¥çš„åŸå› ï¼Œå¹¶è¿›ä¸€æ­¥å¤„ç†çš„é—®é¢˜ãƒ½ (âœ¿ ï¾Ÿ â–½ ï¾Ÿ) ãƒ ğŸ˜</p>\n<h2 id=\"è§£å†³å›è°ƒåœ°ç‹±çš„é—®é¢˜\"><a class=\"anchor\" href=\"#è§£å†³å›è°ƒåœ°ç‹±çš„é—®é¢˜\">#</a> è§£å†³å›è°ƒåœ°ç‹±çš„é—®é¢˜</h2>\n<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦çŸ¥é“ promise å®åˆ—èº«ä¸Šçš„ then æ–¹æ³•æ˜¯ä¼šè¿”å›ä¸€ä¸ª promise å®åˆ—çš„ï¼Œè¿”å›çš„è¿™ä¸ªæ–°çš„å®åˆ—æ˜¯åŸºäº onResolved å‡½æ•° or onRejected å‡½æ•°çš„è¿”å›å€¼æ„å»ºçš„ï¼Œæ˜¯å°†è¿”å›å€¼ä¼ é€’ç»™ Promise.resolve å‡½æ•°æ¥åŒ…è£…ç”Ÿæˆæ–°çš„ promise å®åˆ—ã€‚</p>\n<ul>\n<li>1. å½“è§¦å‘çš„ onResolved or onRejected å‡½æ•°æ²¡æœ‰è¿”å›å€¼æ—¶ï¼Œä¼šé»˜è®¤è¿”å› undefined æ¥ä¼ é€’ç»™ Promise.resolve å‡½æ•°æ¥ç”Ÿæˆæ–°çš„æˆåŠŸçš„ promise å®åˆ—ã€‚</li>\n<li>2. å½“æœ‰è¿”å›å€¼çš„æ—¶å€™ä¼šå°†è¿”å›å€¼ä¼ é€’ç»™ Promise.resolve å‡½æ•°æ¥ç”Ÿæˆæ–°çš„æˆåŠŸçš„ promise å®åˆ—ã€‚</li>\n<li>3. å½“è¿”å›å€¼ä¸ºä¸€ä¸ª promise å®åˆ—çš„æ—¶å€™ä¼šå°†è¯¥ promise å®åˆ—ä¼ é€’ Promise.resolve å‡½æ•°æ¥è¿”å›è¯¥ promise å®åˆ—ã€‚</li>\n<li>4. å½“åœ¨è§¦å‘çš„ onResolved or onRejected å‡½æ•°ä¸­æŠ›å‡ºäº†ä¸€ä¸ªé”™è¯¯æ—¶ï¼Œä¼šå°†è¯¥é”™è¯¯ä¼ é€’ç»™ promise.resolve æ¥è¿”å›ä¸€ä¸ªæ–°çš„å¤±è´¥çš„ promise å®åˆ—ã€‚</li>\n<li>5. å½“å‹æ ¹æ²¡æœ‰éœ€è¦è§¦å‘çš„ onResolved or onRejected å‡½æ•°æ—¶ï¼Œä¼šå°†è°ƒç”¨ then æ–¹æ³•çš„ Promise å®åˆ—åŸæ ·è¿”å›ã€‚</li>\n</ul>\n<p>ç”±äº then æ–¹æ³•å›ºå®šä¼šè¿”å› promise å®åˆ—ï¼Œè¿™å°±ä¸ºé“¾å¼è°ƒç”¨æä¾›äº†å¯èƒ½ï¼Œè€Œé“¾å¼è°ƒç”¨ä¾¿å¯ç»™åµŒå¥—è§£å¥—ï¼Œé¿å…åµŒå¥—ï¼Œè§£å†³å›è°ƒåœ°ç‹±ã€‚<br />\nè‡³æ­¤ï¼Œä¹Ÿè§£å†³äº†å›è°ƒåœ°ç‹±çš„é—®é¢˜ã€‚è¯·çœ‹ä¸‹å›¾ ğŸ˜<br />\n<img data-src=\"https://i.328888.xyz/2023/02/12/cwD6H.png\" alt=\"è§£å†³å›è°ƒåœ°ç‹±\" /></p>\n<p>å½“ç„¶ï¼ŒPromise è¿˜æœ‰å¾ˆå¤šçš„å®åˆ—æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å°±ä¸ä¸€ä¸€è®²è§£ï¼Œè¯»è€…ä»¬ä¸‹å»äº†å¯ä»¥è‡ªè¡Œäº†è§£ã€‚</p>\n",
            "tags": [
                "ç¬”è®°",
                "å‰ç«¯",
                "JavaScript",
                "å‰ç«¯",
                "JSé«˜çº§",
                "Promise"
            ]
        },
        {
            "id": "https://zimu-66ccff.github.io/mySelf/",
            "url": "https://zimu-66ccff.github.io/mySelf/",
            "title": "å…³äºæˆ‘",
            "date_published": "2023-02-11T05:49:30.000Z",
            "content_html": "<p>ä¸€åªå‰ç«¯å°ç™½</p>\n",
            "tags": [
                "éšç¬”",
                "è‡ªæˆ‘"
            ]
        }
    ]
}